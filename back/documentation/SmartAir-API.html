<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" href="SmartAir-API logo-Blue.png" type="image/png" />
    <title>SmartAir API</title>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/monokai-sublime.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    <script>
        hljs.configure({
            tabReplace: '    ',
        });
        hljs.initHighlightingOnLoad();
    </script>
    <style>
        body {
            position: relative;
        }
        
        h1 {
            margin-top: 5px;
        }
        
        .logo {
            text-align: center;
        }
        
        h1,
        h2,
        h3,
        h4 {
            color: #2b2b2b;
        }
        
        h2:after {
            content: ' ';
        }
        
        h5 {
            font-weight: bold;
        }
        
        h1 a,
        h2 a,
        h3 a,
        h4 a,
        h5 a,
        h6 a {
            display: none;
            position: absolute;
            margin-left: 8px;
        }
        
        h1:hover a,
        h2:hover a,
        h3:hover a,
        h4:hover a,
        h5:hover a,
        h6:hover a {
            color: #a5a5a5;
            display: initial;
        }
        
        .nav.nav-tabs>li>a {
            padding-top: 4px;
            padding-bottom: 4px;
        }
        
        .tab-content {
            padding-top: 8px;
        }
        
        .table {
            margin-bottom: 8px;
        }
        
        pre {
            border-radius: 0px;
            border: none;
        }
        
        pre code {
            margin: -9.5px;
        }
        
        .request {
            margin-top: 12px;
            margin-bottom: 24px;
        }
        
        .response-text-sample {
            padding: 0px !important;
        }
        
        .response-text-sample pre {
            margin-bottom: 0px;
        }
        
        #sidebar-wrapper {
            z-index: 1000;
            position: fixed;
            left: 250px;
            width: 250px;
            height: 100%;
            margin-left: -250px;
            overflow-y: auto;
            overflow-x: hidden;
            background: #2b2b2b;
            padding-top: 20px;
        }
        
        #sidebar-wrapper ul {
            width: 250px;
        }
        
        #sidebar-wrapper ul li {
            margin-right: 10px;
        }
        
        #sidebar-wrapper ul li a:hover {
            background: inherit;
            text-decoration: none;
        }
        
        #sidebar-wrapper ul li a {
            display: block;
            color: #ECF0F1;
            padding: 6px 15px;
        }
        
        #sidebar-wrapper ul li ul {
            padding-left: 25px;
        }
        
        #sidebar-wrapper ul li ul li a {
            padding: 1px 0px;
        }
        
        .hljs {
            color: #11c41a;
        }
        
        .hljs-string {
            color: white;
        }
        
        #sidebar-wrapper ul li a:hover,
        #sidebar-wrapper ul li a:focus {
            font-weight: bold;
            color: #11c41a;
            border-right: solid 1px #11c41a;
        }
        
        #sidebar-wrapper ul li.active>a {
            font-weight: bold;
            color: #c41155;
            border-right: solid 3px #c41155;
        }
        
        #sidebar-wrapper ul li:not(.active) ul {
            display: none;
        }
        
        #page-content-wrapper {
            width: 100%;
            position: absolute;
            padding: 15px 15px 15px 250px;
        }
    </style>
</head>

<body data-spy="scroll" data-target=".scrollspy">
    <div id="sidebar-wrapper">
        <div class="scrollspy">
            <ul id="main-menu" data-spy="affix" class="nav">
                <li>
                    <div class="logo">
                        <img src="SmartAir-API logo-White.png" alt="SmartAir-API LOGO" style="width:150px;height:150px;">
                    </div>
                </li>
                <li>
                    <br><br>
                </li>
                <li>
                    <a href="#folder-users">Users</a>
                    <ul>

                        <li>
                            <a href="#request-users-retrieve-users">Retrieve users</a>
                        </li>

                        <li>
                            <a href="#request-users-retrieve-specific-user">Retrieve specific user</a>
                        </li>

                        <li>
                            <a href="#request-users-create-user">Create user</a>
                        </li>

                        <li>
                            <a href="#request-users-patch-user">Patch user</a>
                        </li>

                        <li>
                            <a href="#request-users-delete-user">Delete user</a>
                        </li>

                    </ul>
                </li>


                <li>
                    <a href="#folder-roles">Roles</a>
                    <ul>

                        <li>
                            <a href="#request-roles-retrieve-roles">Retrieve roles</a>
                        </li>

                        <li>
                            <a href="#request-roles-retrieve-specific-role">Retrieve specific role</a>
                        </li>

                        <li>
                            <a href="#request-roles-create-role">Create role</a>
                        </li>

                        <li>
                            <a href="#request-roles-patch-role">Patch role</a>
                        </li>

                        <li>
                            <a href="#request-roles-delete-role">Delete role</a>
                        </li>

                    </ul>
                </li>


                <li>
                    <a href="#folder-devices">Devices</a>
                    <ul>

                        <li>
                            <a href="#request-devices-retrieve-all-devices">Retrieve all devices</a>
                        </li>

                        <li>
                            <a href="#request-devices-retrieve-specific-device">Retrieve specific device</a>
                        </li>

                        <li>
                            <a href="#request-devices-retrieve-sense-devices">Retrieve sense devices</a>
                        </li>

                        <li>
                            <a href="#request-devices-retrieve-control-devices">Retrieve control devices</a>
                        </li>

                        <li>
                            <a href="#request-devices-create-sense-device">Create sense device</a>
                        </li>

                        <li>
                            <a href="#request-devices-create-control-device">Create control device</a>
                        </li>

                        <li>
                            <a href="#request-devices-patch-device">Patch device</a>
                        </li>

                        <li>
                            <a href="#request-devices-delete-device">Delete device</a>
                        </li>

                    </ul>
                </li>


                <li>
                    <a href="#folder-access">Access</a>
                    <ul>

                        <li>
                            <a href="#request-access-login-as-user">Login as user</a>
                        </li>

                        <li>
                            <a href="#request-access-change-password">Change password</a>
                        </li>

                        <li>
                            <a href="#request-access-recover-password">Recover password</a>
                        </li>

                        <li>
                            <a href="#request-access-reset-someone-s-password">Reset someone's password</a>
                        </li>

                    </ul>
                </li>


                <li>
                    <a href="#folder-readings">Readings</a>
                    <ul>

                        <li>
                            <a href="#request-readings-retrieve-readings-of-a-device">Retrieve readings of a device</a>
                        </li>

                    </ul>
                </li>

                <li>
                    <br>
                </li>

                <li>
                    <a href="#folder-node">Node.js API</a>
                    <ul>

                        <li>
                            <a href="#api-broker">MQTT Broker</a>
                        </li>

                        <li>
                            <a href="#api-app">App</a>
                        </li>

                        <li>
                            <a href="#api-server">Server</a>
                        </li>

                        <li>
                            <a href="#api-database">Database connectivity</a>
                        </li>

                        <li>
                            <a href="#api-models">Models</a>
                        </li>

                        <li>
                            <a href="#api-routes">Routes</a>
                        </li>

                        <li>
                            <a href="#api-controllers">Controllers</a>
                        </li>

                        <li>
                            <a href="#api-caching">Caching middleware with Redis</a>
                        </li>

                        <li>
                            <a href="#api-authentication">Authentication for users</a>
                        </li>

                        <li>
                            <a href="#api-utils">Utils</a>
                        </li>
                    </ul>
                </li>

                <li>
                    <br>
                </li>

                <li>
                    <a href="#folder-python">Python code</a>
                    <ul>

                        <li>
                            <a href="#smartair-script">SmartAir Script</a>
                        </li>

                        <li>
                            <a href="#sense-script">Sense Script</a>
                        </li>

                    </ul>
                </li>
                <li>
                    <br>
                </li>
                <li>
                    <a href="#folder-nginx">Nginx configuration</a>
                    <ul>

                        <li>
                            <a href="#nginx-main">Main config file</a>
                        </li>

                        <li>
                            <a href="#nginx-mqtt">MQTT stream config file</a>
                        </li>

                    </ul>
                </li>

                <li>
                    <br>
                </li>

                <li>
                    <a href="#folder-pm2">PM2 configuration</a>
                </li>

                <li>
                    <br>
                </li>

            </ul>
        </div>

    </div>
    <div id="page-content-wrapper">
        <div class="container-fluid">
            <div class="row">
                <div class="col-lg-12">
                    <h1>SmartAir API</h1>
                    <br>
                    <h2 id="doc-general-notes">
                        General notes
                        <a href="#doc-general-notes"><i class="glyphicon glyphicon-link"></i></a>
                        <h5 id="api-description">This is the current version of the SmarAir-API documentation. The web page also contains the Nginx configuration and some Python code snippets.</h5>
                    </h2>

                    <br>
                    <h2 id="doc-api-detail">
                        API description
                        <a href="#doc-api-detail"><i class="glyphicon glyphicon-link"></i></a>
                        <h5 id="api-description">This part describes the HTTP API through different examples of requests and responses. This is not the MQTT API, as fetch defaults to web ports. For MQTT over WebSockets, you'll have to use port 9001.
                        </h5>

                    </h2>

                    <br>





                    <div class="endpoints-group">
                        <h3 id="folder-users">
                            Users
                            <a href="#folder-users"><i class="glyphicon glyphicon-link"></i></a>
                        </h3>

                        <div></div>



                        <div class="request">

                            <h4 id="request-users-retrieve-users">
                                Retrieve users
                                <a href="#request-users-retrieve-users"><i class="glyphicon glyphicon-link"></i></a>
                            </h4>

                            <div></div>

                            <div>
                                <ul class="nav nav-tabs" role="tablist">
                                    <li role="presentation" class="active"><a href="#request-users-retrieve-users-example-curl" data-toggle="tab">Curl</a></li>
                                    <li role="presentation"><a href="#request-users-retrieve-users-example-http" data-toggle="tab">HTTP</a></li>
                                </ul>
                                <div class="tab-content">
                                    <div class="tab-pane active" id="request-users-retrieve-users-example-curl">
                                        <pre><code class="hljs curl">curl -X GET "http://167.71.34.169/api/users"</code></pre>
                                    </div>
                                    <div class="tab-pane" id="request-users-retrieve-users-example-http">
                                        <pre><code class="hljs http">GET /api/users HTTP/1.1
Host: 167.71.34.169</code></pre>
                                    </div>
                                </div>
                            </div>


                            <div>
                                <ul class="nav nav-tabs" role="tablist">

                                    <li role="presentation" class="active">
                                        <a href="#request-users-retrieve-users-responses-b742c41c-c0e6-4913-a4df-514f4be544f1" data-toggle="tab">
                                        
                                            Response
                                        
                                    </a>
                                    </li>

                                </ul>
                                <div class="tab-content">

                                    <div class="tab-pane active" id="request-users-retrieve-users-responses-b742c41c-c0e6-4913-a4df-514f4be544f1">
                                        <table class="table table-bordered">
                                            <tr>
                                                <th style="width: 20%;">Status</th>
                                                <td>200 OK</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Server</th>
                                                <td>nginx/1.17.10 (Ubuntu)</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Date</th>
                                                <td>Tue, 16 Jun 2020 22:46:23 GMT</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Content-Type</th>
                                                <td>application/json; charset=utf-8</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Content-Length</th>
                                                <td>818</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Connection</th>
                                                <td>keep-alive</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">X-Powered-By</th>
                                                <td>Express</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Access-Control-Allow-Origin</th>
                                                <td>*</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">ETag</th>
                                                <td>W/"332-M8FqNGisrs5w5c5COiEWl/JP2X8"</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Vary</th>
                                                <td>Accept-Encoding</td>
                                            </tr>



                                            <tr>
                                                <td class="response-text-sample" colspan="2">
                                                    <pre><code>{
    "users": [
        {
            "roles": [
                "ViewRole"
            ],
            "active": false,
            "needsRelog": true,
            "devices": [
                "device",
                "sense1",
                "control"
            ],
            "username": "test",
            "firstName": "Admin",
            "lastName": "Admin",
            "email": "tanase.anamaria97@gmail.com",
            "session": "2020-06-15T21:52:10.742Z",
            "href": "http://smartair.com/api/users/test"
        },
        {
            "roles": [
                "ViewRole"
            ],
            "active": true,
            "needsRelog": false,
            "devices": [
                "device",
                "sense1",
                "control"
            ],
            "username": "test2",
            "firstName": "Test2",
            "lastName": "Test2",
            "email": "ana.tanase@asaff.ro",
            "session": "2020-06-15T23:17:14.350Z",
            "href": "http://smartair.com/api/users/test2"
        },
        {
            "roles": [
                "ViewRole"
            ],
            "active": false,
            "needsRelog": false,
            "devices": [
                "FD53DF3DK4",
                "GT4TGE4G"
            ],
            "username": "testusername",
            "firstName": "Mahmoud-Tudor",
            "lastName": "Hamdan",
            "email": "hamdan.mahmoudtudor@gmail.com",
            "href": "http://smartair.com/api/users/testusername"
        }
    ],
    "count": 3
}</code></pre>
                                                </td>
                                            </tr>


                                        </table>
                                    </div>

                                </div>
                            </div>


                            <hr>
                        </div>


                        <div class="request">

                            <h4 id="request-users-retrieve-specific-user">
                                Retrieve specific user
                                <a href="#request-users-retrieve-specific-user"><i class="glyphicon glyphicon-link"></i></a>
                            </h4>

                            <div></div>

                            <div>
                                <ul class="nav nav-tabs" role="tablist">
                                    <li role="presentation" class="active"><a href="#request-users-retrieve-specific-user-example-curl" data-toggle="tab">Curl</a></li>
                                    <li role="presentation"><a href="#request-users-retrieve-specific-user-example-http" data-toggle="tab">HTTP</a></li>
                                </ul>
                                <div class="tab-content">
                                    <div class="tab-pane active" id="request-users-retrieve-specific-user-example-curl">
                                        <pre><code class="hljs curl">curl -X GET "http://167.71.34.169/api/users/testusername"</code></pre>
                                    </div>
                                    <div class="tab-pane" id="request-users-retrieve-specific-user-example-http">
                                        <pre><code class="hljs http">GET /api/users/testusername HTTP/1.1
Host: 167.71.34.169</code></pre>
                                    </div>
                                </div>
                            </div>


                            <div>
                                <ul class="nav nav-tabs" role="tablist">

                                    <li role="presentation" class="active">
                                        <a href="#request-users-retrieve-specific-user-responses-a4c6a937-fc6a-43e8-a7e6-bd8dc2140a75" data-toggle="tab">
                                        
                                            Response
                                        
                                    </a>
                                    </li>

                                </ul>
                                <div class="tab-content">

                                    <div class="tab-pane active" id="request-users-retrieve-specific-user-responses-a4c6a937-fc6a-43e8-a7e6-bd8dc2140a75">
                                        <table class="table table-bordered">
                                            <tr>
                                                <th style="width: 20%;">Status</th>
                                                <td>200 OK</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Server</th>
                                                <td>nginx/1.17.10 (Ubuntu)</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Date</th>
                                                <td>Tue, 16 Jun 2020 22:46:34 GMT</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Content-Type</th>
                                                <td>application/json; charset=utf-8</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Content-Length</th>
                                                <td>258</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Connection</th>
                                                <td>keep-alive</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">X-Powered-By</th>
                                                <td>Express</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Access-Control-Allow-Origin</th>
                                                <td>*</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">ETag</th>
                                                <td>W/"102-DNpgFgx2QOc+SjgevAFLAf8ctkI"</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Vary</th>
                                                <td>Accept-Encoding</td>
                                            </tr>



                                            <tr>
                                                <td class="response-text-sample" colspan="2">
                                                    <pre><code>{
    "roles": [
        "ViewRole"
    ],
    "active": false,
    "needsRelog": false,
    "devices": [
        "FD53DF3DK4",
        "GT4TGE4G"
    ],
    "username": "testusername",
    "firstName": "Mahmoud-Tudor",
    "lastName": "Hamdan",
    "email": "hamdan.mahmoudtudor@gmail.com",
    "href": "http://smartair.com/api/users/testusername"
}</code></pre>
                                                </td>
                                            </tr>


                                        </table>
                                    </div>

                                </div>
                            </div>


                            <hr>
                        </div>


                        <div class="request">

                            <h4 id="request-users-create-user">
                                Create user
                                <a href="#request-users-create-user"><i class="glyphicon glyphicon-link"></i></a>
                            </h4>

                            <div></div>

                            <div>
                                <ul class="nav nav-tabs" role="tablist">
                                    <li role="presentation" class="active"><a href="#request-users-create-user-example-curl" data-toggle="tab">Curl</a></li>
                                    <li role="presentation"><a href="#request-users-create-user-example-http" data-toggle="tab">HTTP</a></li>
                                </ul>
                                <div class="tab-content">
                                    <div class="tab-pane active" id="request-users-create-user-example-curl">
                                        <pre><code class="hljs curl">curl -X POST -d '{
	"username": "testusername",
	"firstName": "Mahmoud Tudor",
	"lastName": "Hamdan",
	"email": "hamdan.mahmoudtudor@gmail.com",
	"roles": ["ViewRole"],
	"devices": ["FD53DF3DK4", "GT4TGE4G"]
}' "http://167.71.34.169/api/users"</code></pre>
                                    </div>
                                    <div class="tab-pane" id="request-users-create-user-example-http">
                                        <pre><code class="hljs http">POST /api/users HTTP/1.1
Host: 167.71.34.169

{
	"username": "testusername",
	"firstName": "Mahmoud Tudor",
	"lastName": "Hamdan",
	"email": "hamdan.mahmoudtudor@gmail.com",
	"roles": ["ViewRole"],
	"devices": ["FD53DF3DK4", "GT4TGE4G"]
}</code></pre>
                                    </div>
                                </div>
                            </div>


                            <div>
                                <ul class="nav nav-tabs" role="tablist">

                                    <li role="presentation" class="active">
                                        <a href="#request-users-create-user-responses-a3f2f42c-f89d-47aa-9a5e-5263187dc433" data-toggle="tab">
                                        
                                            Response
                                        
                                    </a>
                                    </li>

                                </ul>
                                <div class="tab-content">

                                    <div class="tab-pane active" id="request-users-create-user-responses-a3f2f42c-f89d-47aa-9a5e-5263187dc433">
                                        <table class="table table-bordered">
                                            <tr>
                                                <th style="width: 20%;">Status</th>
                                                <td>200 OK</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Server</th>
                                                <td>nginx/1.17.10 (Ubuntu)</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Date</th>
                                                <td>Tue, 16 Jun 2020 22:45:51 GMT</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Content-Type</th>
                                                <td>application/json; charset=utf-8</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Content-Length</th>
                                                <td>258</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Connection</th>
                                                <td>keep-alive</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">X-Powered-By</th>
                                                <td>Express</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Access-Control-Allow-Origin</th>
                                                <td>*</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">ETag</th>
                                                <td>W/"102-k6thzHTLAQSRQJ2uAkaNahNfwUU"</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Vary</th>
                                                <td>Accept-Encoding</td>
                                            </tr>



                                            <tr>
                                                <td class="response-text-sample" colspan="2">
                                                    <pre><code>{
    "roles": [
        "ViewRole"
    ],
    "active": false,
    "needsRelog": false,
    "devices": [
        "FD53DF3DK4",
        "GT4TGE4G"
    ],
    "username": "testusername",
    "firstName": "Mahmoud Tudor",
    "lastName": "Hamdan",
    "email": "hamdan.mahmoudtudor@gmail.com",
    "href": "http://smartair.com/api/users/testusername"
}</code></pre>
                                                </td>
                                            </tr>


                                        </table>
                                    </div>

                                </div>
                            </div>


                            <hr>
                        </div>


                        <div class="request">

                            <h4 id="request-users-patch-user">
                                Patch user
                                <a href="#request-users-patch-user"><i class="glyphicon glyphicon-link"></i></a>
                            </h4>

                            <div>
                                <p>Patching different fields of a user.</p>
                            </div>

                            <div>
                                <ul class="nav nav-tabs" role="tablist">
                                    <li role="presentation" class="active"><a href="#request-users-patch-user-example-curl" data-toggle="tab">Curl</a></li>
                                    <li role="presentation"><a href="#request-users-patch-user-example-http" data-toggle="tab">HTTP</a></li>
                                </ul>
                                <div class="tab-content">
                                    <div class="tab-pane active" id="request-users-patch-user-example-curl">
                                        <pre><code class="hljs curl">curl -X PATCH -d '{
	"firstName": "Mahmoud-Tudor"
}' "http://167.71.34.169/api/users/testusername"</code></pre>
                                    </div>
                                    <div class="tab-pane" id="request-users-patch-user-example-http">
                                        <pre><code class="hljs http">PATCH /api/users/testusername HTTP/1.1
Host: 167.71.34.169

{
	"firstName": "Mahmoud-Tudor"
}</code></pre>
                                    </div>
                                </div>
                            </div>


                            <div>
                                <ul class="nav nav-tabs" role="tablist">

                                    <li role="presentation" class="active">
                                        <a href="#request-users-patch-user-responses-d6d14c9c-e8fd-42c9-8a61-aa19269decf1" data-toggle="tab">
                                        
                                            Response
                                        
                                    </a>
                                    </li>

                                </ul>
                                <div class="tab-content">

                                    <div class="tab-pane active" id="request-users-patch-user-responses-d6d14c9c-e8fd-42c9-8a61-aa19269decf1">
                                        <table class="table table-bordered">
                                            <tr>
                                                <th style="width: 20%;">Status</th>
                                                <td>200 OK</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Server</th>
                                                <td>nginx/1.17.10 (Ubuntu)</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Date</th>
                                                <td>Tue, 16 Jun 2020 22:46:13 GMT</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Content-Type</th>
                                                <td>application/json; charset=utf-8</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Content-Length</th>
                                                <td>258</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Connection</th>
                                                <td>keep-alive</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">X-Powered-By</th>
                                                <td>Express</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Access-Control-Allow-Origin</th>
                                                <td>*</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">ETag</th>
                                                <td>W/"102-DNpgFgx2QOc+SjgevAFLAf8ctkI"</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Vary</th>
                                                <td>Accept-Encoding</td>
                                            </tr>



                                            <tr>
                                                <td class="response-text-sample" colspan="2">
                                                    <pre><code>{
    "roles": [
        "ViewRole"
    ],
    "active": false,
    "needsRelog": false,
    "devices": [
        "FD53DF3DK4",
        "GT4TGE4G"
    ],
    "username": "testusername",
    "firstName": "Mahmoud-Tudor",
    "lastName": "Hamdan",
    "email": "hamdan.mahmoudtudor@gmail.com",
    "href": "http://smartair.com/api/users/testusername"
}</code></pre>
                                                </td>
                                            </tr>


                                        </table>
                                    </div>

                                </div>
                            </div>


                            <hr>
                        </div>


                        <div class="request">

                            <h4 id="request-users-delete-user">
                                Delete user
                                <a href="#request-users-delete-user"><i class="glyphicon glyphicon-link"></i></a>
                            </h4>

                            <div></div>

                            <div>
                                <ul class="nav nav-tabs" role="tablist">
                                    <li role="presentation" class="active"><a href="#request-users-delete-user-example-curl" data-toggle="tab">Curl</a></li>
                                    <li role="presentation"><a href="#request-users-delete-user-example-http" data-toggle="tab">HTTP</a></li>
                                </ul>
                                <div class="tab-content">
                                    <div class="tab-pane active" id="request-users-delete-user-example-curl">
                                        <pre><code class="hljs curl">curl -X DELETE "http://167.71.34.169/api/users/testusername"</code></pre>
                                    </div>
                                    <div class="tab-pane" id="request-users-delete-user-example-http">
                                        <pre><code class="hljs http">DELETE /api/users/testusername HTTP/1.1
Host: 167.71.34.169</code></pre>
                                    </div>
                                </div>
                            </div>


                            <div>
                                <ul class="nav nav-tabs" role="tablist">

                                    <li role="presentation" class="active">
                                        <a href="#request-users-delete-user-responses-4a3397c4-0a99-405a-84c1-49bb0a512e1e" data-toggle="tab">
                                        
                                            Response
                                        
                                    </a>
                                    </li>

                                </ul>
                                <div class="tab-content">

                                    <div class="tab-pane active" id="request-users-delete-user-responses-4a3397c4-0a99-405a-84c1-49bb0a512e1e">
                                        <table class="table table-bordered">
                                            <tr>
                                                <th style="width: 20%;">Status</th>
                                                <td>200 OK</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Server</th>
                                                <td>nginx/1.17.10 (Ubuntu)</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Date</th>
                                                <td>Tue, 16 Jun 2020 22:46:45 GMT</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Content-Type</th>
                                                <td>application/json; charset=utf-8</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Content-Length</th>
                                                <td>206</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Connection</th>
                                                <td>keep-alive</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">X-Powered-By</th>
                                                <td>Express</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Access-Control-Allow-Origin</th>
                                                <td>*</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">ETag</th>
                                                <td>W/"ce-aVD1/Pc2LJrrfd52KCJ77AiigxA"</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Vary</th>
                                                <td>Accept-Encoding</td>
                                            </tr>



                                            <tr>
                                                <td class="response-text-sample" colspan="2">
                                                    <pre><code>{
    "roles": [
        "ViewRole"
    ],
    "active": false,
    "needsRelog": false,
    "devices": [
        "FD53DF3DK4",
        "GT4TGE4G"
    ],
    "username": "testusername",
    "firstName": "Mahmoud-Tudor",
    "lastName": "Hamdan",
    "email": "hamdan.mahmoudtudor@gmail.com"
}</code></pre>
                                                </td>
                                            </tr>


                                        </table>
                                    </div>

                                </div>
                            </div>


                            <hr>
                        </div>


                    </div>


                    <div class="endpoints-group">
                        <h3 id="folder-roles">
                            Roles
                            <a href="#folder-roles"><i class="glyphicon glyphicon-link"></i></a>
                        </h3>

                        <div></div>



                        <div class="request">

                            <h4 id="request-roles-retrieve-roles">
                                Retrieve roles
                                <a href="#request-roles-retrieve-roles"><i class="glyphicon glyphicon-link"></i></a>
                            </h4>

                            <div></div>

                            <div>
                                <ul class="nav nav-tabs" role="tablist">
                                    <li role="presentation" class="active"><a href="#request-roles-retrieve-roles-example-curl" data-toggle="tab">Curl</a></li>
                                    <li role="presentation"><a href="#request-roles-retrieve-roles-example-http" data-toggle="tab">HTTP</a></li>
                                </ul>
                                <div class="tab-content">
                                    <div class="tab-pane active" id="request-roles-retrieve-roles-example-curl">
                                        <pre><code class="hljs curl">curl -X GET "http://167.71.34.169/api/roles"</code></pre>
                                    </div>
                                    <div class="tab-pane" id="request-roles-retrieve-roles-example-http">
                                        <pre><code class="hljs http">GET /api/roles HTTP/1.1
Host: 167.71.34.169</code></pre>
                                    </div>
                                </div>
                            </div>


                            <div>
                                <ul class="nav nav-tabs" role="tablist">

                                    <li role="presentation" class="active">
                                        <a href="#request-roles-retrieve-roles-responses-8f7cae3e-5622-447a-846f-7605058af1d3" data-toggle="tab">
                                        
                                            Response
                                        
                                    </a>
                                    </li>

                                </ul>
                                <div class="tab-content">

                                    <div class="tab-pane active" id="request-roles-retrieve-roles-responses-8f7cae3e-5622-447a-846f-7605058af1d3">
                                        <table class="table table-bordered">
                                            <tr>
                                                <th style="width: 20%;">Status</th>
                                                <td>200 OK</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Server</th>
                                                <td>nginx/1.17.10 (Ubuntu)</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Date</th>
                                                <td>Tue, 16 Jun 2020 22:46:56 GMT</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Content-Type</th>
                                                <td>application/json; charset=utf-8</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Transfer-Encoding</th>
                                                <td>chunked</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Connection</th>
                                                <td>keep-alive</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">X-Powered-By</th>
                                                <td>Express</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Access-Control-Allow-Origin</th>
                                                <td>*</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">ETag</th>
                                                <td>W/"520-hYpVWwQa7N11ts5/M7KCvL8HgMA"</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Vary</th>
                                                <td>Accept-Encoding</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Content-Encoding</th>
                                                <td>gzip</td>
                                            </tr>



                                            <tr>
                                                <td class="response-text-sample" colspan="2">
                                                    <pre><code>{
    "roles": [
        {
            "accessList": [
                {
                    "component": "dashboard",
                    "permissions": {
                        "access": true,
                        "retrieve": true,
                        "create": true,
                        "update": true,
                        "delete": true
                    }
                },
                {
                    "component": "roles",
                    "permissions": {
                        "access": true,
                        "retrieve": true,
                        "create": true,
                        "update": true,
                        "delete": true
                    }
                },
                {
                    "component": "users",
                    "permissions": {
                        "access": true,
                        "retrieve": true,
                        "create": true,
                        "update": true,
                        "delete": true
                    }
                },
                {
                    "component": "devices",
                    "permissions": {
                        "access": true,
                        "retrieve": true,
                        "create": true,
                        "update": true,
                        "delete": true
                    }
                },
                {
                    "component": "profile",
                    "permissions": {
                        "access": true,
                        "retrieve": true,
                        "create": true,
                        "update": true,
                        "delete": true
                    }
                }
            ],
            "name": "admin",
            "href": "http://smartair.com/api/roles/admin"
        },
        {
            "accessList": [
                {
                    "component": "dashboard",
                    "permissions": {
                        "access": true,
                        "retrieve": true,
                        "create": false,
                        "update": false,
                        "delete": false
                    }
                },
                {
                    "component": "roles",
                    "permissions": {
                        "access": true,
                        "retrieve": true,
                        "create": false,
                        "update": false,
                        "delete": false
                    }
                },
                {
                    "component": "users",
                    "permissions": {
                        "access": true,
                        "retrieve": true,
                        "create": false,
                        "update": false,
                        "delete": false
                    }
                },
                {
                    "component": "devices",
                    "permissions": {
                        "access": true,
                        "retrieve": true,
                        "create": false,
                        "update": false,
                        "delete": false
                    }
                },
                {
                    "component": "profile",
                    "permissions": {
                        "access": true,
                        "retrieve": true,
                        "create": false,
                        "update": false,
                        "delete": false
                    }
                }
            ],
            "name": "ViewRole",
            "href": "http://smartair.com/api/roles/ViewRole"
        }
    ],
    "count": 2
}</code></pre>
                                                </td>
                                            </tr>


                                        </table>
                                    </div>

                                </div>
                            </div>


                            <hr>
                        </div>


                        <div class="request">

                            <h4 id="request-roles-retrieve-specific-role">
                                Retrieve specific role
                                <a href="#request-roles-retrieve-specific-role"><i class="glyphicon glyphicon-link"></i></a>
                            </h4>

                            <div></div>

                            <div>
                                <ul class="nav nav-tabs" role="tablist">
                                    <li role="presentation" class="active"><a href="#request-roles-retrieve-specific-role-example-curl" data-toggle="tab">Curl</a></li>
                                    <li role="presentation"><a href="#request-roles-retrieve-specific-role-example-http" data-toggle="tab">HTTP</a></li>
                                </ul>
                                <div class="tab-content">
                                    <div class="tab-pane active" id="request-roles-retrieve-specific-role-example-curl">
                                        <pre><code class="hljs curl">curl -X GET "http://167.71.34.169/api/roles/ViewRole"</code></pre>
                                    </div>
                                    <div class="tab-pane" id="request-roles-retrieve-specific-role-example-http">
                                        <pre><code class="hljs http">GET /api/roles/ViewRole HTTP/1.1
Host: 167.71.34.169</code></pre>
                                    </div>
                                </div>
                            </div>


                            <div>
                                <ul class="nav nav-tabs" role="tablist">

                                    <li role="presentation" class="active">
                                        <a href="#request-roles-retrieve-specific-role-responses-df13c032-fabd-45f1-88aa-29dfacadc6c2" data-toggle="tab">
                                        
                                            Response
                                        
                                    </a>
                                    </li>

                                </ul>
                                <div class="tab-content">

                                    <div class="tab-pane active" id="request-roles-retrieve-specific-role-responses-df13c032-fabd-45f1-88aa-29dfacadc6c2">
                                        <table class="table table-bordered">
                                            <tr>
                                                <th style="width: 20%;">Status</th>
                                                <td>200 OK</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Server</th>
                                                <td>nginx/1.17.10 (Ubuntu)</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Date</th>
                                                <td>Tue, 16 Jun 2020 22:47:14 GMT</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Content-Type</th>
                                                <td>application/json; charset=utf-8</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Content-Length</th>
                                                <td>655</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Connection</th>
                                                <td>keep-alive</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">X-Powered-By</th>
                                                <td>Express</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Access-Control-Allow-Origin</th>
                                                <td>*</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">ETag</th>
                                                <td>W/"28f-eamUED74QDQArzSdF4Z6M6e2Ep0"</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Vary</th>
                                                <td>Accept-Encoding</td>
                                            </tr>



                                            <tr>
                                                <td class="response-text-sample" colspan="2">
                                                    <pre><code>{
    "accessList": [
        {
            "component": "dashboard",
            "permissions": {
                "access": true,
                "retrieve": true,
                "create": false,
                "update": false,
                "delete": false
            }
        },
        {
            "component": "roles",
            "permissions": {
                "access": true,
                "retrieve": true,
                "create": false,
                "update": false,
                "delete": false
            }
        },
        {
            "component": "users",
            "permissions": {
                "access": true,
                "retrieve": true,
                "create": false,
                "update": false,
                "delete": false
            }
        },
        {
            "component": "devices",
            "permissions": {
                "access": true,
                "retrieve": true,
                "create": false,
                "update": false,
                "delete": false
            }
        },
        {
            "component": "profile",
            "permissions": {
                "access": true,
                "retrieve": true,
                "create": false,
                "update": false,
                "delete": false
            }
        }
    ],
    "name": "ViewRole",
    "href": "http://smartair.com/api/roles/ViewRole"
}</code></pre>
                                                </td>
                                            </tr>


                                        </table>
                                    </div>

                                </div>
                            </div>


                            <hr>
                        </div>


                        <div class="request">

                            <h4 id="request-roles-create-role">
                                Create role
                                <a href="#request-roles-create-role"><i class="glyphicon glyphicon-link"></i></a>
                            </h4>

                            <div></div>

                            <div>
                                <ul class="nav nav-tabs" role="tablist">
                                    <li role="presentation" class="active"><a href="#request-roles-create-role-example-curl" data-toggle="tab">Curl</a></li>
                                    <li role="presentation"><a href="#request-roles-create-role-example-http" data-toggle="tab">HTTP</a></li>
                                </ul>
                                <div class="tab-content">
                                    <div class="tab-pane active" id="request-roles-create-role-example-curl">
                                        <pre><code class="hljs curl">curl -X POST -d '{
	"name": "TestRole",
	"accessList": [
		{
			"component": "dashboard",
			"permissions": {
				"access": true,
				"retrieve": true,
				"create": true,
				"update": true,
				"delete": true
				
			}
		},
		{
			"component": "roles",
			"permissions": {
				"access": true,
				"retrieve": true,
				"create": false,
				"update": false,
				"delete": true
				
			}
		},
		{
			"component": "users",
			"permissions": {
				"access": false,
				"retrieve": true,
				"create": true,
				"update": true,
				"delete": false
				
			}
		},
		{
			"component": "devices",
			"permissions": {
				"access": true,
				"retrieve": false,
				"create": true,
				"update": true,
				"delete": true
				
			}
		},
		{
			"component": "profile",
			"permissions": {
				"access": true,
				"retrieve": true,
				"create": true,
				"update": false,
				"delete": true
				
			}
		}
	]
}' "http://167.71.34.169/api/roles"</code></pre>
                                    </div>
                                    <div class="tab-pane" id="request-roles-create-role-example-http">
                                        <pre><code class="hljs http">POST /api/roles HTTP/1.1
Host: 167.71.34.169

{
	"name": "TestRole",
	"accessList": [
		{
			"component": "dashboard",
			"permissions": {
				"access": true,
				"retrieve": true,
				"create": true,
				"update": true,
				"delete": true
				
			}
		},
		{
			"component": "roles",
			"permissions": {
				"access": true,
				"retrieve": true,
				"create": false,
				"update": false,
				"delete": true
				
			}
		},
		{
			"component": "users",
			"permissions": {
				"access": false,
				"retrieve": true,
				"create": true,
				"update": true,
				"delete": false
				
			}
		},
		{
			"component": "devices",
			"permissions": {
				"access": true,
				"retrieve": false,
				"create": true,
				"update": true,
				"delete": true
				
			}
		},
		{
			"component": "profile",
			"permissions": {
				"access": true,
				"retrieve": true,
				"create": true,
				"update": false,
				"delete": true
				
			}
		}
	]
}</code></pre>
                                    </div>
                                </div>
                            </div>


                            <div>
                                <ul class="nav nav-tabs" role="tablist">

                                    <li role="presentation" class="active">
                                        <a href="#request-roles-create-role-responses-31e6083e-4c5b-43ce-a195-160c737f4451" data-toggle="tab">
                                        
                                            Response
                                        
                                    </a>
                                    </li>

                                </ul>
                                <div class="tab-content">

                                    <div class="tab-pane active" id="request-roles-create-role-responses-31e6083e-4c5b-43ce-a195-160c737f4451">
                                        <table class="table table-bordered">
                                            <tr>
                                                <th style="width: 20%;">Status</th>
                                                <td>200 OK</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Server</th>
                                                <td>nginx/1.17.10 (Ubuntu)</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Date</th>
                                                <td>Tue, 16 Jun 2020 22:47:37 GMT</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Content-Type</th>
                                                <td>application/json; charset=utf-8</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Content-Length</th>
                                                <td>646</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Connection</th>
                                                <td>keep-alive</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">X-Powered-By</th>
                                                <td>Express</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Access-Control-Allow-Origin</th>
                                                <td>*</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">ETag</th>
                                                <td>W/"286-VTKdWbczlJMZtShF74c0LtSfXQ4"</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Vary</th>
                                                <td>Accept-Encoding</td>
                                            </tr>



                                            <tr>
                                                <td class="response-text-sample" colspan="2">
                                                    <pre><code>{
    "accessList": [
        {
            "component": "dashboard",
            "permissions": {
                "access": true,
                "retrieve": true,
                "create": true,
                "update": true,
                "delete": true
            }
        },
        {
            "component": "roles",
            "permissions": {
                "access": true,
                "retrieve": true,
                "create": false,
                "update": false,
                "delete": true
            }
        },
        {
            "component": "users",
            "permissions": {
                "access": false,
                "retrieve": true,
                "create": true,
                "update": true,
                "delete": false
            }
        },
        {
            "component": "devices",
            "permissions": {
                "access": true,
                "retrieve": false,
                "create": true,
                "update": true,
                "delete": true
            }
        },
        {
            "component": "profile",
            "permissions": {
                "access": true,
                "retrieve": true,
                "create": true,
                "update": false,
                "delete": true
            }
        }
    ],
    "name": "TestRole",
    "href": "http://smartair.com/api/roles/TestRole"
}</code></pre>
                                                </td>
                                            </tr>


                                        </table>
                                    </div>

                                </div>
                            </div>


                            <hr>
                        </div>


                        <div class="request">

                            <h4 id="request-roles-patch-role">
                                Patch role
                                <a href="#request-roles-patch-role"><i class="glyphicon glyphicon-link"></i></a>
                            </h4>

                            <div></div>

                            <div>
                                <ul class="nav nav-tabs" role="tablist">
                                    <li role="presentation" class="active"><a href="#request-roles-patch-role-example-curl" data-toggle="tab">Curl</a></li>
                                    <li role="presentation"><a href="#request-roles-patch-role-example-http" data-toggle="tab">HTTP</a></li>
                                </ul>
                                <div class="tab-content">
                                    <div class="tab-pane active" id="request-roles-patch-role-example-curl">
                                        <pre><code class="hljs curl">curl -X PATCH -d '{
	"accessList": [
                {
                    "component": "dashboard",
                    "permissions": {
                        "access": true,
                        "retrieve": true,
                        "create": true,
                        "update": true,
                        "delete": true
                    }
                },
                {
                    "component": "roles",
                    "permissions": {
                        "access": true,
                        "retrieve": true,
                        "create": true,
                        "update": true,
                        "delete": true
                    }
                },
                {
                    "component": "users",
                    "permissions": {
                        "access": true,
                        "retrieve": true,
                        "create": true,
                        "update": true,
                        "delete": true
                    }
                },
                {
                    "component": "devices",
                    "permissions": {
                        "access": true,
                        "retrieve": true,
                        "create": true,
                        "update": true,
                        "delete": true
                    }
                },
                {
                    "component": "profile",
                    "permissions": {
                        "access": true,
                        "retrieve": true,
                        "create": true,
                        "update": true,
                        "delete": true
                    }
                }
            ]
}' "http://167.71.34.169/api/roles/TestRole"</code></pre>
                                    </div>
                                    <div class="tab-pane" id="request-roles-patch-role-example-http">
                                        <pre><code class="hljs http">PATCH /api/roles/TestRole HTTP/1.1
Host: 167.71.34.169

{
	"accessList": [
                {
                    "component": "dashboard",
                    "permissions": {
                        "access": true,
                        "retrieve": true,
                        "create": true,
                        "update": true,
                        "delete": true
                    }
                },
                {
                    "component": "roles",
                    "permissions": {
                        "access": true,
                        "retrieve": true,
                        "create": true,
                        "update": true,
                        "delete": true
                    }
                },
                {
                    "component": "users",
                    "permissions": {
                        "access": true,
                        "retrieve": true,
                        "create": true,
                        "update": true,
                        "delete": true
                    }
                },
                {
                    "component": "devices",
                    "permissions": {
                        "access": true,
                        "retrieve": true,
                        "create": true,
                        "update": true,
                        "delete": true
                    }
                },
                {
                    "component": "profile",
                    "permissions": {
                        "access": true,
                        "retrieve": true,
                        "create": true,
                        "update": true,
                        "delete": true
                    }
                }
            ]
}</code></pre>
                                    </div>
                                </div>
                            </div>


                            <div>
                                <ul class="nav nav-tabs" role="tablist">

                                    <li role="presentation" class="active">
                                        <a href="#request-roles-patch-role-responses-848f57b3-a83a-4a6d-86e1-565e219f9b5a" data-toggle="tab">
                                        
                                            Response
                                        
                                    </a>
                                    </li>

                                </ul>
                                <div class="tab-content">

                                    <div class="tab-pane active" id="request-roles-patch-role-responses-848f57b3-a83a-4a6d-86e1-565e219f9b5a">
                                        <table class="table table-bordered">
                                            <tr>
                                                <th style="width: 20%;">Status</th>
                                                <td>200 OK</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Server</th>
                                                <td>nginx/1.17.10 (Ubuntu)</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Date</th>
                                                <td>Tue, 16 Jun 2020 22:48:00 GMT</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Content-Type</th>
                                                <td>application/json; charset=utf-8</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Content-Length</th>
                                                <td>640</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Connection</th>
                                                <td>keep-alive</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">X-Powered-By</th>
                                                <td>Express</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Access-Control-Allow-Origin</th>
                                                <td>*</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">ETag</th>
                                                <td>W/"280-JIr1dNJoj5TbjECaSTFanZw7Gc4"</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Vary</th>
                                                <td>Accept-Encoding</td>
                                            </tr>



                                            <tr>
                                                <td class="response-text-sample" colspan="2">
                                                    <pre><code>{
    "accessList": [
        {
            "component": "dashboard",
            "permissions": {
                "access": true,
                "retrieve": true,
                "create": true,
                "update": true,
                "delete": true
            }
        },
        {
            "component": "roles",
            "permissions": {
                "access": true,
                "retrieve": true,
                "create": true,
                "update": true,
                "delete": true
            }
        },
        {
            "component": "users",
            "permissions": {
                "access": true,
                "retrieve": true,
                "create": true,
                "update": true,
                "delete": true
            }
        },
        {
            "component": "devices",
            "permissions": {
                "access": true,
                "retrieve": true,
                "create": true,
                "update": true,
                "delete": true
            }
        },
        {
            "component": "profile",
            "permissions": {
                "access": true,
                "retrieve": true,
                "create": true,
                "update": true,
                "delete": true
            }
        }
    ],
    "name": "TestRole",
    "href": "http://smartair.com/api/roles/TestRole"
}</code></pre>
                                                </td>
                                            </tr>


                                        </table>
                                    </div>

                                </div>
                            </div>


                            <hr>
                        </div>


                        <div class="request">

                            <h4 id="request-roles-delete-role">
                                Delete role
                                <a href="#request-roles-delete-role"><i class="glyphicon glyphicon-link"></i></a>
                            </h4>

                            <div></div>

                            <div>
                                <ul class="nav nav-tabs" role="tablist">
                                    <li role="presentation" class="active"><a href="#request-roles-delete-role-example-curl" data-toggle="tab">Curl</a></li>
                                    <li role="presentation"><a href="#request-roles-delete-role-example-http" data-toggle="tab">HTTP</a></li>
                                </ul>
                                <div class="tab-content">
                                    <div class="tab-pane active" id="request-roles-delete-role-example-curl">
                                        <pre><code class="hljs curl">curl -X DELETE "http://167.71.34.169/api/roles/TestRole"</code></pre>
                                    </div>
                                    <div class="tab-pane" id="request-roles-delete-role-example-http">
                                        <pre><code class="hljs http">DELETE /api/roles/TestRole HTTP/1.1
Host: 167.71.34.169</code></pre>
                                    </div>
                                </div>
                            </div>


                            <div>
                                <ul class="nav nav-tabs" role="tablist">

                                    <li role="presentation" class="active">
                                        <a href="#request-roles-delete-role-responses-37ea4511-53eb-48df-9506-7c993a6f9eeb" data-toggle="tab">
                                        
                                            Response
                                        
                                    </a>
                                    </li>

                                </ul>
                                <div class="tab-content">

                                    <div class="tab-pane active" id="request-roles-delete-role-responses-37ea4511-53eb-48df-9506-7c993a6f9eeb">
                                        <table class="table table-bordered">
                                            <tr>
                                                <th style="width: 20%;">Status</th>
                                                <td>200 OK</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Server</th>
                                                <td>nginx/1.17.10 (Ubuntu)</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Date</th>
                                                <td>Tue, 16 Jun 2020 22:48:14 GMT</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Content-Type</th>
                                                <td>application/json; charset=utf-8</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Content-Length</th>
                                                <td>592</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Connection</th>
                                                <td>keep-alive</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">X-Powered-By</th>
                                                <td>Express</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Access-Control-Allow-Origin</th>
                                                <td>*</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">ETag</th>
                                                <td>W/"250-mIkGaOgmE+n6Ls6X9o4U0+Mvl/Q"</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Vary</th>
                                                <td>Accept-Encoding</td>
                                            </tr>



                                            <tr>
                                                <td class="response-text-sample" colspan="2">
                                                    <pre><code>{
    "accessList": [
        {
            "component": "dashboard",
            "permissions": {
                "access": true,
                "retrieve": true,
                "create": true,
                "update": true,
                "delete": true
            }
        },
        {
            "component": "roles",
            "permissions": {
                "access": true,
                "retrieve": true,
                "create": true,
                "update": true,
                "delete": true
            }
        },
        {
            "component": "users",
            "permissions": {
                "access": true,
                "retrieve": true,
                "create": true,
                "update": true,
                "delete": true
            }
        },
        {
            "component": "devices",
            "permissions": {
                "access": true,
                "retrieve": true,
                "create": true,
                "update": true,
                "delete": true
            }
        },
        {
            "component": "profile",
            "permissions": {
                "access": true,
                "retrieve": true,
                "create": true,
                "update": true,
                "delete": true
            }
        }
    ],
    "name": "TestRole"
}</code></pre>
                                                </td>
                                            </tr>


                                        </table>
                                    </div>

                                </div>
                            </div>


                            <hr>
                        </div>


                    </div>


                    <div class="endpoints-group">
                        <h3 id="folder-devices">
                            Devices
                            <a href="#folder-devices"><i class="glyphicon glyphicon-link"></i></a>
                        </h3>

                        <div></div>



                        <div class="request">

                            <h4 id="request-devices-retrieve-all-devices">
                                Retrieve all devices
                                <a href="#request-devices-retrieve-all-devices"><i class="glyphicon glyphicon-link"></i></a>
                            </h4>

                            <div></div>

                            <div>
                                <ul class="nav nav-tabs" role="tablist">
                                    <li role="presentation" class="active"><a href="#request-devices-retrieve-all-devices-example-curl" data-toggle="tab">Curl</a></li>
                                    <li role="presentation"><a href="#request-devices-retrieve-all-devices-example-http" data-toggle="tab">HTTP</a></li>
                                </ul>
                                <div class="tab-content">
                                    <div class="tab-pane active" id="request-devices-retrieve-all-devices-example-curl">
                                        <pre><code class="hljs curl">curl -X GET "http://167.71.34.169/api/devices"</code></pre>
                                    </div>
                                    <div class="tab-pane" id="request-devices-retrieve-all-devices-example-http">
                                        <pre><code class="hljs http">GET /api/devices HTTP/1.1
Host: 167.71.34.169</code></pre>
                                    </div>
                                </div>
                            </div>


                            <div>
                                <ul class="nav nav-tabs" role="tablist">

                                    <li role="presentation" class="active">
                                        <a href="#request-devices-retrieve-all-devices-responses-af47483f-fbff-4bb0-8db1-dbff6a02f51a" data-toggle="tab">
                                        
                                            Response
                                        
                                    </a>
                                    </li>

                                </ul>
                                <div class="tab-content">

                                    <div class="tab-pane active" id="request-devices-retrieve-all-devices-responses-af47483f-fbff-4bb0-8db1-dbff6a02f51a">
                                        <table class="table table-bordered">
                                            <tr>
                                                <th style="width: 20%;">Status</th>
                                                <td>200 OK</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Server</th>
                                                <td>nginx/1.17.10 (Ubuntu)</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Date</th>
                                                <td>Tue, 16 Jun 2020 22:48:29 GMT</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Content-Type</th>
                                                <td>application/json; charset=utf-8</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Content-Length</th>
                                                <td>764</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Connection</th>
                                                <td>keep-alive</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">X-Powered-By</th>
                                                <td>Express</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Access-Control-Allow-Origin</th>
                                                <td>*</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">ETag</th>
                                                <td>W/"2fc-A3R3EmXSyJbZUbPSFo8T8NfFYEo"</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Vary</th>
                                                <td>Accept-Encoding</td>
                                            </tr>



                                            <tr>
                                                <td class="response-text-sample" colspan="2">
                                                    <pre><code>{
    "devices": [
        {
            "active": false,
            "devices": [],
            "username": "device",
            "type": "sense",
            "href": "http://smartair.com/api/devices/device"
        },
        {
            "active": false,
            "devices": [],
            "username": "sense1",
            "type": "sense",
            "href": "http://smartair.com/api/devices/sense1"
        },
        {
            "active": false,
            "devices": [
                "device",
                "sense1",
                "sense2",
                "sense3"
            ],
            "username": "control",
            "type": "control",
            "href": "http://smartair.com/api/devices/control"
        },
        {
            "active": false,
            "devices": [],
            "username": "GT4TGE4G",
            "type": "control",
            "href": "http://smartair.com/api/devices/GT4TGE4G"
        },
        {
            "active": false,
            "devices": [],
            "username": "KLD4MF2S98",
            "type": "sense",
            "href": "http://smartair.com/api/devices/KLD4MF2S98"
        },
        {
            "active": false,
            "devices": [],
            "username": "FL3FG56FQ1",
            "type": "control",
            "href": "http://smartair.com/api/devices/FL3FG56FQ1"
        }
    ],
    "count": 6
}</code></pre>
                                                </td>
                                            </tr>


                                        </table>
                                    </div>

                                </div>
                            </div>


                            <hr>
                        </div>


                        <div class="request">

                            <h4 id="request-devices-retrieve-specific-device">
                                Retrieve specific device
                                <a href="#request-devices-retrieve-specific-device"><i class="glyphicon glyphicon-link"></i></a>
                            </h4>

                            <div></div>

                            <div>
                                <ul class="nav nav-tabs" role="tablist">
                                    <li role="presentation" class="active"><a href="#request-devices-retrieve-specific-device-example-curl" data-toggle="tab">Curl</a></li>
                                    <li role="presentation"><a href="#request-devices-retrieve-specific-device-example-http" data-toggle="tab">HTTP</a></li>
                                </ul>
                                <div class="tab-content">
                                    <div class="tab-pane active" id="request-devices-retrieve-specific-device-example-curl">
                                        <pre><code class="hljs curl">curl -X GET "http://167.71.34.169/api/devices/sense1"</code></pre>
                                    </div>
                                    <div class="tab-pane" id="request-devices-retrieve-specific-device-example-http">
                                        <pre><code class="hljs http">GET /api/devices/sense1 HTTP/1.1
Host: 167.71.34.169</code></pre>
                                    </div>
                                </div>
                            </div>


                            <div>
                                <ul class="nav nav-tabs" role="tablist">

                                    <li role="presentation" class="active">
                                        <a href="#request-devices-retrieve-specific-device-responses-2962e9e9-0f32-4e59-8d1c-e073f2f6282e" data-toggle="tab">
                                        
                                            Response
                                        
                                    </a>
                                    </li>

                                </ul>
                                <div class="tab-content">

                                    <div class="tab-pane active" id="request-devices-retrieve-specific-device-responses-2962e9e9-0f32-4e59-8d1c-e073f2f6282e">
                                        <table class="table table-bordered">
                                            <tr>
                                                <th style="width: 20%;">Status</th>
                                                <td>200 OK</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Server</th>
                                                <td>nginx/1.17.10 (Ubuntu)</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Date</th>
                                                <td>Tue, 16 Jun 2020 22:48:45 GMT</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Content-Type</th>
                                                <td>application/json; charset=utf-8</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Content-Length</th>
                                                <td>112</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Connection</th>
                                                <td>keep-alive</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">X-Powered-By</th>
                                                <td>Express</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Access-Control-Allow-Origin</th>
                                                <td>*</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">ETag</th>
                                                <td>W/"70-vh0c13ckYz17xny2lEup0J9asno"</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Vary</th>
                                                <td>Accept-Encoding</td>
                                            </tr>



                                            <tr>
                                                <td class="response-text-sample" colspan="2">
                                                    <pre><code>{
    "active": false,
    "devices": [],
    "username": "sense1",
    "type": "sense",
    "href": "http://smartair.com/api/devices/sense1"
}</code></pre>
                                                </td>
                                            </tr>


                                        </table>
                                    </div>

                                </div>
                            </div>


                            <hr>
                        </div>


                        <div class="request">

                            <h4 id="request-devices-retrieve-sense-devices">
                                Retrieve sense devices
                                <a href="#request-devices-retrieve-sense-devices"><i class="glyphicon glyphicon-link"></i></a>
                            </h4>

                            <div></div>

                            <div>
                                <ul class="nav nav-tabs" role="tablist">
                                    <li role="presentation" class="active"><a href="#request-devices-retrieve-sense-devices-example-curl" data-toggle="tab">Curl</a></li>
                                    <li role="presentation"><a href="#request-devices-retrieve-sense-devices-example-http" data-toggle="tab">HTTP</a></li>
                                </ul>
                                <div class="tab-content">
                                    <div class="tab-pane active" id="request-devices-retrieve-sense-devices-example-curl">
                                        <pre><code class="hljs curl">curl -X GET "http://167.71.34.169/api/devices?type=sense"</code></pre>
                                    </div>
                                    <div class="tab-pane" id="request-devices-retrieve-sense-devices-example-http">
                                        <pre><code class="hljs http">GET /api/devices?type=sense HTTP/1.1
Host: 167.71.34.169</code></pre>
                                    </div>
                                </div>
                            </div>


                            <div>
                                <ul class="nav nav-tabs" role="tablist">

                                    <li role="presentation" class="active">
                                        <a href="#request-devices-retrieve-sense-devices-responses-8400a0af-010f-42a5-955f-28587e787df9" data-toggle="tab">
                                        
                                            Response
                                        
                                    </a>
                                    </li>

                                </ul>
                                <div class="tab-content">

                                    <div class="tab-pane active" id="request-devices-retrieve-sense-devices-responses-8400a0af-010f-42a5-955f-28587e787df9">
                                        <table class="table table-bordered">
                                            <tr>
                                                <th style="width: 20%;">Status</th>
                                                <td>200 OK</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Server</th>
                                                <td>nginx/1.17.10 (Ubuntu)</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Date</th>
                                                <td>Tue, 16 Jun 2020 22:49:03 GMT</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Content-Type</th>
                                                <td>application/json; charset=utf-8</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Content-Length</th>
                                                <td>403</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Connection</th>
                                                <td>keep-alive</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">X-Powered-By</th>
                                                <td>Express</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Access-Control-Allow-Origin</th>
                                                <td>*</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">ETag</th>
                                                <td>W/"193-AmRnacYnkIrB7BKGKwjAgOQcPSs"</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Vary</th>
                                                <td>Accept-Encoding</td>
                                            </tr>



                                            <tr>
                                                <td class="response-text-sample" colspan="2">
                                                    <pre><code>{
    "devices": [
        {
            "active": false,
            "devices": [],
            "username": "device",
            "type": "sense",
            "href": "http://smartair.com/api/devices?type=sense/device"
        },
        {
            "active": false,
            "devices": [],
            "username": "sense1",
            "type": "sense",
            "href": "http://smartair.com/api/devices?type=sense/sense1"
        },
        {
            "active": false,
            "devices": [],
            "username": "KLD4MF2S98",
            "type": "sense",
            "href": "http://smartair.com/api/devices?type=sense/KLD4MF2S98"
        }
    ],
    "count": 3
}</code></pre>
                                                </td>
                                            </tr>


                                        </table>
                                    </div>

                                </div>
                            </div>


                            <hr>
                        </div>


                        <div class="request">

                            <h4 id="request-devices-retrieve-control-devices">
                                Retrieve control devices
                                <a href="#request-devices-retrieve-control-devices"><i class="glyphicon glyphicon-link"></i></a>
                            </h4>

                            <div></div>

                            <div>
                                <ul class="nav nav-tabs" role="tablist">
                                    <li role="presentation" class="active"><a href="#request-devices-retrieve-control-devices-example-curl" data-toggle="tab">Curl</a></li>
                                    <li role="presentation"><a href="#request-devices-retrieve-control-devices-example-http" data-toggle="tab">HTTP</a></li>
                                </ul>
                                <div class="tab-content">
                                    <div class="tab-pane active" id="request-devices-retrieve-control-devices-example-curl">
                                        <pre><code class="hljs curl">curl -X GET "http://167.71.34.169/api/devices?type=control"</code></pre>
                                    </div>
                                    <div class="tab-pane" id="request-devices-retrieve-control-devices-example-http">
                                        <pre><code class="hljs http">GET /api/devices?type=control HTTP/1.1
Host: 167.71.34.169</code></pre>
                                    </div>
                                </div>
                            </div>


                            <div>
                                <ul class="nav nav-tabs" role="tablist">

                                    <li role="presentation" class="active">
                                        <a href="#request-devices-retrieve-control-devices-responses-0f5fa746-e3ca-4215-93db-4575f1249a27" data-toggle="tab">
                                        
                                            Response
                                        
                                    </a>
                                    </li>

                                </ul>
                                <div class="tab-content">

                                    <div class="tab-pane active" id="request-devices-retrieve-control-devices-responses-0f5fa746-e3ca-4215-93db-4575f1249a27">
                                        <table class="table table-bordered">
                                            <tr>
                                                <th style="width: 20%;">Status</th>
                                                <td>200 OK</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Server</th>
                                                <td>nginx/1.17.10 (Ubuntu)</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Date</th>
                                                <td>Tue, 16 Jun 2020 22:49:13 GMT</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Content-Type</th>
                                                <td>application/json; charset=utf-8</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Content-Length</th>
                                                <td>456</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Connection</th>
                                                <td>keep-alive</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">X-Powered-By</th>
                                                <td>Express</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Access-Control-Allow-Origin</th>
                                                <td>*</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">ETag</th>
                                                <td>W/"1c8-YBJrEvVwBLmmyieVzTWi299NfrI"</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Vary</th>
                                                <td>Accept-Encoding</td>
                                            </tr>



                                            <tr>
                                                <td class="response-text-sample" colspan="2">
                                                    <pre><code>{
    "devices": [
        {
            "active": false,
            "devices": [
                "device",
                "sense1",
                "sense2",
                "sense3"
            ],
            "username": "control",
            "type": "control",
            "href": "http://smartair.com/api/devices?type=control/control"
        },
        {
            "active": false,
            "devices": [],
            "username": "GT4TGE4G",
            "type": "control",
            "href": "http://smartair.com/api/devices?type=control/GT4TGE4G"
        },
        {
            "active": false,
            "devices": [],
            "username": "FL3FG56FQ1",
            "type": "control",
            "href": "http://smartair.com/api/devices?type=control/FL3FG56FQ1"
        }
    ],
    "count": 3
}</code></pre>
                                                </td>
                                            </tr>


                                        </table>
                                    </div>

                                </div>
                            </div>


                            <hr>
                        </div>


                        <div class="request">

                            <h4 id="request-devices-create-sense-device">
                                Create sense device
                                <a href="#request-devices-create-sense-device"><i class="glyphicon glyphicon-link"></i></a>
                            </h4>

                            <div></div>

                            <div>
                                <ul class="nav nav-tabs" role="tablist">
                                    <li role="presentation" class="active"><a href="#request-devices-create-sense-device-example-curl" data-toggle="tab">Curl</a></li>
                                    <li role="presentation"><a href="#request-devices-create-sense-device-example-http" data-toggle="tab">HTTP</a></li>
                                </ul>
                                <div class="tab-content">
                                    <div class="tab-pane active" id="request-devices-create-sense-device-example-curl">
                                        <pre><code class="hljs curl">curl -X POST -d '{
	"username": "FD53DF3DK4",
	"password": "fgewdgfewg",
	"type": "sense"
}' "http://167.71.34.169/api/devices/"</code></pre>
                                    </div>
                                    <div class="tab-pane" id="request-devices-create-sense-device-example-http">
                                        <pre><code class="hljs http">POST /api/devices/ HTTP/1.1
Host: 167.71.34.169

{
	"username": "FD53DF3DK4",
	"password": "fgewdgfewg",
	"type": "sense"
}</code></pre>
                                    </div>
                                </div>
                            </div>


                            <div>
                                <ul class="nav nav-tabs" role="tablist">

                                    <li role="presentation" class="active">
                                        <a href="#request-devices-create-sense-device-responses-98857cb0-629a-4725-9040-e74ee88b9ebd" data-toggle="tab">
                                        
                                            Response
                                        
                                    </a>
                                    </li>

                                </ul>
                                <div class="tab-content">

                                    <div class="tab-pane active" id="request-devices-create-sense-device-responses-98857cb0-629a-4725-9040-e74ee88b9ebd">
                                        <table class="table table-bordered">
                                            <tr>
                                                <th style="width: 20%;">Status</th>
                                                <td>200 OK</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Server</th>
                                                <td>nginx/1.17.10 (Ubuntu)</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Date</th>
                                                <td>Tue, 16 Jun 2020 22:50:06 GMT</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Content-Type</th>
                                                <td>application/json; charset=utf-8</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Content-Length</th>
                                                <td>120</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Connection</th>
                                                <td>keep-alive</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">X-Powered-By</th>
                                                <td>Express</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Access-Control-Allow-Origin</th>
                                                <td>*</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">ETag</th>
                                                <td>W/"78-aawccBHVC9qPOGWYaRr9GovBBcw"</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Vary</th>
                                                <td>Accept-Encoding</td>
                                            </tr>



                                            <tr>
                                                <td class="response-text-sample" colspan="2">
                                                    <pre><code>{
    "active": false,
    "devices": [],
    "username": "FD53DF3DK4",
    "type": "sense",
    "href": "http://smartair.com/api/devices/FD53DF3DK4"
}</code></pre>
                                                </td>
                                            </tr>


                                        </table>
                                    </div>

                                </div>
                            </div>


                            <hr>
                        </div>


                        <div class="request">

                            <h4 id="request-devices-create-control-device">
                                Create control device
                                <a href="#request-devices-create-control-device"><i class="glyphicon glyphicon-link"></i></a>
                            </h4>

                            <div></div>

                            <div>
                                <ul class="nav nav-tabs" role="tablist">
                                    <li role="presentation" class="active"><a href="#request-devices-create-control-device-example-curl" data-toggle="tab">Curl</a></li>
                                    <li role="presentation"><a href="#request-devices-create-control-device-example-http" data-toggle="tab">HTTP</a></li>
                                </ul>
                                <div class="tab-content">
                                    <div class="tab-pane active" id="request-devices-create-control-device-example-curl">
                                        <pre><code class="hljs curl">curl -X POST -d '{
	"username": "FL3FG56FQ1",
	"password": "fdsgth54y4",
	"type": "control"
}' "http://167.71.34.169/api/devices/"</code></pre>
                                    </div>
                                    <div class="tab-pane" id="request-devices-create-control-device-example-http">
                                        <pre><code class="hljs http">POST /api/devices/ HTTP/1.1
Host: 167.71.34.169

{
	"username": "FL3FG56FQ1",
	"password": "fdsgth54y4",
	"type": "control"
}</code></pre>
                                    </div>
                                </div>
                            </div>


                            <div>
                                <ul class="nav nav-tabs" role="tablist">

                                    <li role="presentation" class="active">
                                        <a href="#request-devices-create-control-device-responses-e794a653-6450-4785-ba2c-6723a5cc02b3" data-toggle="tab">
                                        
                                            Response
                                        
                                    </a>
                                    </li>

                                </ul>
                                <div class="tab-content">

                                    <div class="tab-pane active" id="request-devices-create-control-device-responses-e794a653-6450-4785-ba2c-6723a5cc02b3">
                                        <table class="table table-bordered">
                                            <tr>
                                                <th style="width: 20%;">Status</th>
                                                <td>400 Bad Request</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Server</th>
                                                <td>nginx/1.17.10 (Ubuntu)</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Date</th>
                                                <td>Tue, 16 Jun 2020 22:50:23 GMT</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Transfer-Encoding</th>
                                                <td>chunked</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Connection</th>
                                                <td>keep-alive</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">X-Powered-By</th>
                                                <td>Express</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Access-Control-Allow-Origin</th>
                                                <td>*</td>
                                            </tr>


                                        </table>
                                    </div>

                                </div>
                            </div>


                            <hr>
                        </div>


                        <div class="request">

                            <h4 id="request-devices-patch-device">
                                Patch device
                                <a href="#request-devices-patch-device"><i class="glyphicon glyphicon-link"></i></a>
                            </h4>

                            <div>
                                <p>Patching different fields of a device.</p>
                            </div>

                            <div>
                                <ul class="nav nav-tabs" role="tablist">
                                    <li role="presentation" class="active"><a href="#request-devices-patch-device-example-curl" data-toggle="tab">Curl</a></li>
                                    <li role="presentation"><a href="#request-devices-patch-device-example-http" data-toggle="tab">HTTP</a></li>
                                </ul>
                                <div class="tab-content">
                                    <div class="tab-pane active" id="request-devices-patch-device-example-curl">
                                        <pre><code class="hljs curl">curl -X PATCH -H "Content-Type: application/json" -d '{
	"type": "control",
	"devices": ["sense1"]
}' "http://167.71.34.169/api/devices/FD53DF3DK4/"</code></pre>
                                    </div>
                                    <div class="tab-pane" id="request-devices-patch-device-example-http">
                                        <pre><code class="hljs http">PATCH /api/devices/FD53DF3DK4/ HTTP/1.1
Host: 167.71.34.169
Content-Type: application/json

{
	"type": "control",
	"devices": ["sense1"]
}</code></pre>
                                    </div>
                                </div>
                            </div>


                            <div>
                                <ul class="nav nav-tabs" role="tablist">

                                    <li role="presentation" class="active">
                                        <a href="#request-devices-patch-device-responses-03af471c-4b41-4cfe-abdb-bce5bc45f69c" data-toggle="tab">
                                        
                                            Response
                                        
                                    </a>
                                    </li>

                                </ul>
                                <div class="tab-content">

                                    <div class="tab-pane active" id="request-devices-patch-device-responses-03af471c-4b41-4cfe-abdb-bce5bc45f69c">
                                        <table class="table table-bordered">
                                            <tr>
                                                <th style="width: 20%;">Status</th>
                                                <td>200 OK</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Server</th>
                                                <td>nginx/1.17.10 (Ubuntu)</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Date</th>
                                                <td>Tue, 16 Jun 2020 22:51:08 GMT</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Content-Type</th>
                                                <td>application/json; charset=utf-8</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Content-Length</th>
                                                <td>130</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Connection</th>
                                                <td>keep-alive</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">X-Powered-By</th>
                                                <td>Express</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Access-Control-Allow-Origin</th>
                                                <td>*</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">ETag</th>
                                                <td>W/"82-4+Zej1hnR2/ydmf21rfIE4VAXpo"</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Vary</th>
                                                <td>Accept-Encoding</td>
                                            </tr>



                                            <tr>
                                                <td class="response-text-sample" colspan="2">
                                                    <pre><code>{
    "active": false,
    "devices": [
        "sense1"
    ],
    "username": "FD53DF3DK4",
    "type": "control",
    "href": "http://smartair.com/api/devices/FD53DF3DK4"
}</code></pre>
                                                </td>
                                            </tr>


                                        </table>
                                    </div>

                                </div>
                            </div>


                            <hr>
                        </div>


                        <div class="request">

                            <h4 id="request-devices-delete-device">
                                Delete device
                                <a href="#request-devices-delete-device"><i class="glyphicon glyphicon-link"></i></a>
                            </h4>

                            <div></div>

                            <div>
                                <ul class="nav nav-tabs" role="tablist">
                                    <li role="presentation" class="active"><a href="#request-devices-delete-device-example-curl" data-toggle="tab">Curl</a></li>
                                    <li role="presentation"><a href="#request-devices-delete-device-example-http" data-toggle="tab">HTTP</a></li>
                                </ul>
                                <div class="tab-content">
                                    <div class="tab-pane active" id="request-devices-delete-device-example-curl">
                                        <pre><code class="hljs curl">curl -X DELETE "http://167.71.34.169/api/devices/FD53DF3DK4/"</code></pre>
                                    </div>
                                    <div class="tab-pane" id="request-devices-delete-device-example-http">
                                        <pre><code class="hljs http">DELETE /api/devices/FD53DF3DK4/ HTTP/1.1
Host: 167.71.34.169</code></pre>
                                    </div>
                                </div>
                            </div>


                            <div>
                                <ul class="nav nav-tabs" role="tablist">

                                    <li role="presentation" class="active">
                                        <a href="#request-devices-delete-device-responses-bb660ac0-247b-4593-898f-249cd5dcefd2" data-toggle="tab">
                                        
                                            Response
                                        
                                    </a>
                                    </li>

                                </ul>
                                <div class="tab-content">

                                    <div class="tab-pane active" id="request-devices-delete-device-responses-bb660ac0-247b-4593-898f-249cd5dcefd2">
                                        <table class="table table-bordered">
                                            <tr>
                                                <th style="width: 20%;">Status</th>
                                                <td>200 OK</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Server</th>
                                                <td>nginx/1.17.10 (Ubuntu)</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Date</th>
                                                <td>Tue, 16 Jun 2020 22:49:48 GMT</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Content-Type</th>
                                                <td>application/json; charset=utf-8</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Content-Length</th>
                                                <td>68</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Connection</th>
                                                <td>keep-alive</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">X-Powered-By</th>
                                                <td>Express</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Access-Control-Allow-Origin</th>
                                                <td>*</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">ETag</th>
                                                <td>W/"44-X7xzoUNVAlIykRTHHnRTfW/3hcM"</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Vary</th>
                                                <td>Accept-Encoding</td>
                                            </tr>



                                            <tr>
                                                <td class="response-text-sample" colspan="2">
                                                    <pre><code>{
    "active": false,
    "devices": [],
    "username": "FD53DF3DK4",
    "type": "sense"
}</code></pre>
                                                </td>
                                            </tr>


                                        </table>
                                    </div>

                                </div>
                            </div>


                            <hr>
                        </div>


                    </div>


                    <div class="endpoints-group">
                        <h3 id="folder-access">
                            Access
                            <a href="#folder-access"><i class="glyphicon glyphicon-link"></i></a>
                        </h3>

                        <div></div>



                        <div class="request">

                            <h4 id="request-access-login-as-user">
                                Login as user
                                <a href="#request-access-login-as-user"><i class="glyphicon glyphicon-link"></i></a>
                            </h4>

                            <div></div>

                            <div>
                                <ul class="nav nav-tabs" role="tablist">
                                    <li role="presentation" class="active"><a href="#request-access-login-as-user-example-curl" data-toggle="tab">Curl</a></li>
                                    <li role="presentation"><a href="#request-access-login-as-user-example-http" data-toggle="tab">HTTP</a></li>
                                </ul>
                                <div class="tab-content">
                                    <div class="tab-pane active" id="request-access-login-as-user-example-curl">
                                        <pre><code class="hljs curl">curl -X POST -d '{
	"auth": {
		"username": "test2",
		"password": "Parola11$$"		
	}

}' "http://167.71.34.169/api/access/login"</code></pre>
                                    </div>
                                    <div class="tab-pane" id="request-access-login-as-user-example-http">
                                        <pre><code class="hljs http">POST /api/access/login HTTP/1.1
Host: 167.71.34.169

{
	"auth": {
		"username": "test2",
		"password": "Parola11$$"		
	}

}</code></pre>
                                    </div>
                                </div>
                            </div>


                            <div>
                                <ul class="nav nav-tabs" role="tablist">

                                    <li role="presentation" class="active">
                                        <a href="#request-access-login-as-user-responses-c73a2186-025b-4a11-8feb-fd47ab50f61f" data-toggle="tab">
                                        
                                            Login as user
                                        
                                    </a>
                                    </li>

                                    <li role="presentation">
                                        <a href="#request-access-login-as-user-responses-274f46bd-e62b-4375-98b3-241862a08000" data-toggle="tab">
                                        
                                            Login as user failure
                                        
                                    </a>
                                    </li>

                                </ul>
                                <div class="tab-content">

                                    <div class="tab-pane active" id="request-access-login-as-user-responses-c73a2186-025b-4a11-8feb-fd47ab50f61f">
                                        <table class="table table-bordered">
                                            <tr>
                                                <th style="width: 20%;">Status</th>
                                                <td>200 OK</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Server</th>
                                                <td>nginx/1.17.10 (Ubuntu)</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Date</th>
                                                <td>Tue, 16 Jun 2020 22:51:25 GMT</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Content-Type</th>
                                                <td>application/json; charset=utf-8</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Transfer-Encoding</th>
                                                <td>chunked</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Connection</th>
                                                <td>keep-alive</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">X-Powered-By</th>
                                                <td>Express</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Access-Control-Allow-Origin</th>
                                                <td>*</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">ETag</th>
                                                <td>W/"831-xPQM9L46QR6xPW7Xa5HVdFM17cA"</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Vary</th>
                                                <td>Accept-Encoding</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Content-Encoding</th>
                                                <td>gzip</td>
                                            </tr>



                                            <tr>
                                                <td class="response-text-sample" colspan="2">
                                                    <pre><code>{
    "user": {
        "roles": [
            {
                "accessList": [
                    {
                        "component": "dashboard",
                        "permissions": {
                            "access": true,
                            "retrieve": true,
                            "create": false,
                            "update": false,
                            "delete": false
                        }
                    },
                    {
                        "component": "roles",
                        "permissions": {
                            "access": true,
                            "retrieve": true,
                            "create": false,
                            "update": false,
                            "delete": false
                        }
                    },
                    {
                        "component": "users",
                        "permissions": {
                            "access": true,
                            "retrieve": true,
                            "create": false,
                            "update": false,
                            "delete": false
                        }
                    },
                    {
                        "component": "devices",
                        "permissions": {
                            "access": true,
                            "retrieve": true,
                            "create": false,
                            "update": false,
                            "delete": false
                        }
                    },
                    {
                        "component": "profile",
                        "permissions": {
                            "access": true,
                            "retrieve": true,
                            "create": false,
                            "update": false,
                            "delete": false
                        }
                    }
                ],
                "name": "ViewRole"
            }
        ],
        "active": true,
        "needsRelog": false,
        "devices": [
            "device",
            "sense1",
            "control"
        ],
        "username": "test2",
        "firstName": "Test2",
        "lastName": "Test2",
        "email": "ana.tanase@asaff.ro",
        "session": "2020-06-16T22:51:25.490Z"
    },
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyIjp7InJvbGVzIjpbeyJhY2Nlc3NMaXN0IjpbeyJjb21wb25lbnQiOiJkYXNoYm9hcmQiLCJwZXJtaXNzaW9ucyI6eyJhY2Nlc3MiOnRydWUsInJldHJpZXZlIjp0cnVlLCJjcmVhdGUiOmZhbHNlLCJ1cGRhdGUiOmZhbHNlLCJkZWxldGUiOmZhbHNlfX0seyJjb21wb25lbnQiOiJyb2xlcyIsInBlcm1pc3Npb25zIjp7ImFjY2VzcyI6dHJ1ZSwicmV0cmlldmUiOnRydWUsImNyZWF0ZSI6ZmFsc2UsInVwZGF0ZSI6ZmFsc2UsImRlbGV0ZSI6ZmFsc2V9fSx7ImNvbXBvbmVudCI6InVzZXJzIiwicGVybWlzc2lvbnMiOnsiYWNjZXNzIjp0cnVlLCJyZXRyaWV2ZSI6dHJ1ZSwiY3JlYXRlIjpmYWxzZSwidXBkYXRlIjpmYWxzZSwiZGVsZXRlIjpmYWxzZX19LHsiY29tcG9uZW50IjoiZGV2aWNlcyIsInBlcm1pc3Npb25zIjp7ImFjY2VzcyI6dHJ1ZSwicmV0cmlldmUiOnRydWUsImNyZWF0ZSI6ZmFsc2UsInVwZGF0ZSI6ZmFsc2UsImRlbGV0ZSI6ZmFsc2V9fSx7ImNvbXBvbmVudCI6InByb2ZpbGUiLCJwZXJtaXNzaW9ucyI6eyJhY2Nlc3MiOnRydWUsInJldHJpZXZlIjp0cnVlLCJjcmVhdGUiOmZhbHNlLCJ1cGRhdGUiOmZhbHNlLCJkZWxldGUiOmZhbHNlfX1dLCJuYW1lIjoiVmlld1JvbGUifV0sImFjdGl2ZSI6dHJ1ZSwibmVlZHNSZWxvZyI6ZmFsc2UsImRldmljZXMiOlsiZGV2aWNlIiwic2Vuc2UxIiwiY29udHJvbCJdLCJ1c2VybmFtZSI6InRlc3QyIiwiZmlyc3ROYW1lIjoiVGVzdDIiLCJsYXN0TmFtZSI6IlRlc3QyIiwiZW1haWwiOiJhbmEudGFuYXNlQGFzYWZmLnJvIiwic2Vzc2lvbiI6IjIwMjAtMDYtMTZUMjI6NTE6MjUuNDkwWiJ9LCJpYXQiOjE1OTIzNDc4ODU0OTAsImV4cCI6MTU5MjM5MTA4NTQ5MCwiaXNzIjoiU21hcnQgQWlyIn0.bKZE45h34AVogx3F9pk8EfpAD9Da9_F2M28Yanjyeyk"
}</code></pre>
                                                </td>
                                            </tr>


                                        </table>
                                    </div>

                                    <div class="tab-pane" id="request-access-login-as-user-responses-274f46bd-e62b-4375-98b3-241862a08000">
                                        <table class="table table-bordered">
                                            <tr>
                                                <th style="width: 20%;">Status</th>
                                                <td>401 Unauthorized</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Server</th>
                                                <td>nginx/1.17.10 (Ubuntu)</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Date</th>
                                                <td>Tue, 16 Jun 2020 22:51:43 GMT</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Transfer-Encoding</th>
                                                <td>chunked</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Connection</th>
                                                <td>keep-alive</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">X-Powered-By</th>
                                                <td>Express</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Access-Control-Allow-Origin</th>
                                                <td>*</td>
                                            </tr>


                                        </table>
                                    </div>

                                </div>
                            </div>


                            <hr>
                        </div>


                        <div class="request">

                            <h4 id="request-access-change-password">
                                Change password
                                <a href="#request-access-change-password"><i class="glyphicon glyphicon-link"></i></a>
                            </h4>

                            <div></div>

                            <div>
                                <ul class="nav nav-tabs" role="tablist">
                                    <li role="presentation" class="active"><a href="#request-access-change-password-example-curl" data-toggle="tab">Curl</a></li>
                                    <li role="presentation"><a href="#request-access-change-password-example-http" data-toggle="tab">HTTP</a></li>
                                </ul>
                                <div class="tab-content">
                                    <div class="tab-pane active" id="request-access-change-password-example-curl">
                                        <pre><code class="hljs curl">curl -X POST -d '{
    "oldPassword": "1592347998989",
    "newPassword": "someverybadpassword"
}' "http://167.71.34.169/api/access/password/change/testusername"</code></pre>
                                    </div>
                                    <div class="tab-pane" id="request-access-change-password-example-http">
                                        <pre><code class="hljs http">POST /api/access/password/change/testusername HTTP/1.1
Host: 167.71.34.169

{
    "oldPassword": "1592347998989",
    "newPassword": "someverybadpassword"
}</code></pre>
                                    </div>
                                </div>
                            </div>


                            <div>
                                <ul class="nav nav-tabs" role="tablist">

                                    <li role="presentation" class="active">
                                        <a href="#request-access-change-password-responses-2ded83ab-bac4-4731-97a4-fd30209c6d9a" data-toggle="tab">
                                        
                                            Response
                                        
                                    </a>
                                    </li>

                                </ul>
                                <div class="tab-content">

                                    <div class="tab-pane active" id="request-access-change-password-responses-2ded83ab-bac4-4731-97a4-fd30209c6d9a">
                                        <table class="table table-bordered">
                                            <tr>
                                                <th style="width: 20%;">Status</th>
                                                <td>200 OK</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Server</th>
                                                <td>nginx/1.17.10 (Ubuntu)</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Date</th>
                                                <td>Tue, 16 Jun 2020 22:53:31 GMT</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Transfer-Encoding</th>
                                                <td>chunked</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Connection</th>
                                                <td>keep-alive</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">X-Powered-By</th>
                                                <td>Express</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Access-Control-Allow-Origin</th>
                                                <td>*</td>
                                            </tr>


                                        </table>
                                    </div>

                                </div>
                            </div>


                            <hr>
                        </div>


                        <div class="request">

                            <h4 id="request-access-recover-password">
                                Recover password
                                <a href="#request-access-recover-password"><i class="glyphicon glyphicon-link"></i></a>
                            </h4>

                            <div></div>

                            <div>
                                <ul class="nav nav-tabs" role="tablist">
                                    <li role="presentation" class="active"><a href="#request-access-recover-password-example-curl" data-toggle="tab">Curl</a></li>
                                    <li role="presentation"><a href="#request-access-recover-password-example-http" data-toggle="tab">HTTP</a></li>
                                </ul>
                                <div class="tab-content">
                                    <div class="tab-pane active" id="request-access-recover-password-example-curl">
                                        <pre><code class="hljs curl">curl -X POST -d '{
    "identification": "thisuserdoesnotexist"
}' "http://167.71.34.169/api/access/password/recovery"</code></pre>
                                    </div>
                                    <div class="tab-pane" id="request-access-recover-password-example-http">
                                        <pre><code class="hljs http">POST /api/access/password/recovery HTTP/1.1
Host: 167.71.34.169

{
    "identification": "thisuserdoesnotexist"
}</code></pre>
                                    </div>
                                </div>
                            </div>


                            <div>
                                <ul class="nav nav-tabs" role="tablist">

                                    <li role="presentation" class="active">
                                        <a href="#request-access-recover-password-responses-b80bd357-61e0-40fb-9e5b-93bc44b040a3" data-toggle="tab">
                                        
                                            Recover password failure
                                        
                                    </a>
                                    </li>

                                    <li role="presentation">
                                        <a href="#request-access-recover-password-responses-e9967974-1635-4771-86cf-4303513c9d42" data-toggle="tab">
                                        
                                            Recover password by username
                                        
                                    </a>
                                    </li>

                                    <li role="presentation">
                                        <a href="#request-access-recover-password-responses-ffd4dde3-a476-4451-a6f6-4bf9fb0245c9" data-toggle="tab">
                                        
                                            Recover password by mail
                                        
                                    </a>
                                    </li>

                                </ul>
                                <div class="tab-content">

                                    <div class="tab-pane active" id="request-access-recover-password-responses-b80bd357-61e0-40fb-9e5b-93bc44b040a3">
                                        <table class="table table-bordered">
                                            <tr>
                                                <th style="width: 20%;">Status</th>
                                                <td>401 Unauthorized</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Server</th>
                                                <td>nginx/1.17.10 (Ubuntu)</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Date</th>
                                                <td>Tue, 16 Jun 2020 22:54:27 GMT</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Transfer-Encoding</th>
                                                <td>chunked</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Connection</th>
                                                <td>keep-alive</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">X-Powered-By</th>
                                                <td>Express</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Access-Control-Allow-Origin</th>
                                                <td>*</td>
                                            </tr>


                                        </table>
                                    </div>

                                    <div class="tab-pane" id="request-access-recover-password-responses-e9967974-1635-4771-86cf-4303513c9d42">
                                        <table class="table table-bordered">
                                            <tr>
                                                <th style="width: 20%;">Status</th>
                                                <td>200 OK</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Server</th>
                                                <td>nginx/1.17.10 (Ubuntu)</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Date</th>
                                                <td>Tue, 16 Jun 2020 22:54:01 GMT</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Transfer-Encoding</th>
                                                <td>chunked</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Connection</th>
                                                <td>keep-alive</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">X-Powered-By</th>
                                                <td>Express</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Access-Control-Allow-Origin</th>
                                                <td>*</td>
                                            </tr>


                                        </table>
                                    </div>

                                    <div class="tab-pane" id="request-access-recover-password-responses-ffd4dde3-a476-4451-a6f6-4bf9fb0245c9">
                                        <table class="table table-bordered">
                                            <tr>
                                                <th style="width: 20%;">Status</th>
                                                <td>200 OK</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Server</th>
                                                <td>nginx/1.17.10 (Ubuntu)</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Date</th>
                                                <td>Tue, 16 Jun 2020 22:53:45 GMT</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Transfer-Encoding</th>
                                                <td>chunked</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Connection</th>
                                                <td>keep-alive</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">X-Powered-By</th>
                                                <td>Express</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Access-Control-Allow-Origin</th>
                                                <td>*</td>
                                            </tr>


                                        </table>
                                    </div>

                                </div>
                            </div>


                            <hr>
                        </div>


                        <div class="request">

                            <h4 id="request-access-reset-someone-s-password">
                                Reset someone's password
                                <a href="#request-access-reset-someone-s-password"><i class="glyphicon glyphicon-link"></i></a>
                            </h4>

                            <div></div>

                            <div>
                                <ul class="nav nav-tabs" role="tablist">
                                    <li role="presentation" class="active"><a href="#request-access-reset-someone-s-password-example-curl" data-toggle="tab">Curl</a></li>
                                    <li role="presentation"><a href="#request-access-reset-someone-s-password-example-http" data-toggle="tab">HTTP</a></li>
                                </ul>
                                <div class="tab-content">
                                    <div class="tab-pane active" id="request-access-reset-someone-s-password-example-curl">
                                        <pre><code class="hljs curl">curl -X POST "http://167.71.34.169/api/access/password/reset/testusername"</code></pre>
                                    </div>
                                    <div class="tab-pane" id="request-access-reset-someone-s-password-example-http">
                                        <pre><code class="hljs http">POST /api/access/password/reset/testusername HTTP/1.1
Host: 167.71.34.169</code></pre>
                                    </div>
                                </div>
                            </div>


                            <div>
                                <ul class="nav nav-tabs" role="tablist">

                                    <li role="presentation" class="active">
                                        <a href="#request-access-reset-someone-s-password-responses-d71d4aaa-b9f6-4d62-99cb-38d34078fd04" data-toggle="tab">
                                        
                                            Response
                                        
                                    </a>
                                    </li>

                                </ul>
                                <div class="tab-content">

                                    <div class="tab-pane active" id="request-access-reset-someone-s-password-responses-d71d4aaa-b9f6-4d62-99cb-38d34078fd04">
                                        <table class="table table-bordered">
                                            <tr>
                                                <th style="width: 20%;">Status</th>
                                                <td>200 OK</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Server</th>
                                                <td>nginx/1.17.10 (Ubuntu)</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Date</th>
                                                <td>Tue, 16 Jun 2020 22:54:42 GMT</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Transfer-Encoding</th>
                                                <td>chunked</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Connection</th>
                                                <td>keep-alive</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">X-Powered-By</th>
                                                <td>Express</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Access-Control-Allow-Origin</th>
                                                <td>*</td>
                                            </tr>


                                        </table>
                                    </div>

                                </div>
                            </div>


                            <hr>
                        </div>


                    </div>


                    <div class="endpoints-group">
                        <h3 id="folder-readings">
                            Readings
                            <a href="#folder-readings"><i class="glyphicon glyphicon-link"></i></a>
                        </h3>

                        <div></div>



                        <div class="request">

                            <h4 id="request-readings-retrieve-readings-of-a-device">
                                Retrieve readings of a device
                                <a href="#request-readings-retrieve-readings-of-a-device"><i class="glyphicon glyphicon-link"></i></a>
                            </h4>

                            <div></div>

                            <div>
                                <ul class="nav nav-tabs" role="tablist">
                                    <li role="presentation" class="active"><a href="#request-readings-retrieve-readings-of-a-device-example-curl" data-toggle="tab">Curl</a></li>
                                    <li role="presentation"><a href="#request-readings-retrieve-readings-of-a-device-example-http" data-toggle="tab">HTTP</a></li>
                                </ul>
                                <div class="tab-content">
                                    <div class="tab-pane active" id="request-readings-retrieve-readings-of-a-device-example-curl">
                                        <pre><code class="hljs curl">curl -X GET "http://167.71.34.169/api/devices/sense1/readings?from=2020-06-11T01:59:53.286Z&to=2020-06-11T02:01:20.605Z"</code></pre>
                                    </div>
                                    <div class="tab-pane" id="request-readings-retrieve-readings-of-a-device-example-http">
                                        <pre><code class="hljs http">GET /api/devices/sense1/readings?from=2020-06-11T01:59:53.286Z&to=2020-06-11T02:01:20.605Z HTTP/1.1
Host: 167.71.34.169</code></pre>
                                    </div>
                                </div>
                            </div>


                            <div>
                                <ul class="nav nav-tabs" role="tablist">

                                    <li role="presentation" class="active">
                                        <a href="#request-readings-retrieve-readings-of-a-device-responses-8b623792-1077-4849-bbbb-5bd9c06a7f7c" data-toggle="tab">
                                        
                                            Response
                                        
                                    </a>
                                    </li>

                                </ul>
                                <div class="tab-content">

                                    <div class="tab-pane active" id="request-readings-retrieve-readings-of-a-device-responses-8b623792-1077-4849-bbbb-5bd9c06a7f7c">
                                        <table class="table table-bordered">
                                            <tr>
                                                <th style="width: 20%;">Status</th>
                                                <td>200 OK</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Server</th>
                                                <td>nginx/1.17.10 (Ubuntu)</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Date</th>
                                                <td>Tue, 16 Jun 2020 22:58:29 GMT</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Content-Type</th>
                                                <td>application/json; charset=utf-8</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Content-Length</th>
                                                <td>839</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Connection</th>
                                                <td>keep-alive</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">X-Powered-By</th>
                                                <td>Express</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Access-Control-Allow-Origin</th>
                                                <td>*</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">ETag</th>
                                                <td>W/"347-xxgmQdRgeH6fBIHY3Q07UcVU0jk"</td>
                                            </tr>

                                            <tr>
                                                <th style="width: 20%;">Vary</th>
                                                <td>Accept-Encoding</td>
                                            </tr>



                                            <tr>
                                                <td class="response-text-sample" colspan="2">
                                                    <pre><code>{
    "readings": [
        {
            "date": "2020-06-11T01:59:56.978Z",
            "values": {
                "general": {
                    "temperature": 18.408980076748392,
                    "humidity": 46.83433593965692,
                    "pressure": 941.9680409155023
                },
                "hazardous": {
                    "vibration": false
                },
                "poisonous": {
                    "smoke": 12.879877328162804,
                    "co": 15.226962646924784,
                    "ch4": 2.5319761066352067
                }
            }
        },
        {
            "date": "2020-06-11T01:59:59.978Z",
            "values": {
                "general": {
                    "temperature": 33.51250657018343,
                    "humidity": 50.02445351805327,
                    "pressure": 1001.1662312900455
                },
                "hazardous": {
                    "vibration": false
                },
                "poisonous": {
                    "smoke": 12.19624163058839,
                    "co": 31.382528461291656,
                    "ch4": 2.420824265803806
                }
            }
        },
        {
            "date": "2020-06-11T02:00:02.981Z",
            "values": {
                "general": {
                    "temperature": 16.208425363944222,
                    "humidity": 72.63974343051831,
                    "pressure": 1027.4476857275579
                },
                "hazardous": {
                    "vibration": false
                },
                "poisonous": {
                    "smoke": 12.631958631060169,
                    "co": 14.086844413893779,
                    "ch4": 3.3335178429575634
                }
            }
        }
    ],
    "count": 3
}</code></pre>
                                                </td>
                                            </tr>


                                        </table>
                                    </div>

                                </div>
                            </div>


                            <hr>
                        </div>







                        <!--

                        -->


                        <div class="endpoints-group">
                            <h3 id="folder-node">
                                The Typescript code of our API
                                <a href="#folder-node"><i class="glyphicon glyphicon-link"></i></a>
                            </h3>

                            <div class="request">

                                <h4 id="api-broker">
                                    This file contains the MQTT broker definition.
                                    <a href="#request-readings-retrieve-readings-of-a-device"><i class="glyphicon glyphicon-link"></i></a>
                                </h4>
                                <table class="table table-bordered">
                                    <tr>
                                        <td class="response-text-sample" colspan="1">
                                            <pre>
                                                <code>
import * as mosca from 'mosca';
import { DeviceModel as Device } from './models/Device';
import crypto from 'crypto';
import { createReading } from './utils/elasticUtils';

const _db = require('./db');
const PORT = Number(process.env.PORT) || 9001;
const settings = {
    http: {
    port: PORT,
    bundle: true,
    static: './',
    },
};

const broker = new mosca.Server(settings);

broker.on('ready', () => {
    console.log('MQTT broker is up and running on port ' + PORT);
    broker.authenticate = authenticate;
    broker.authorizePublish = authorizePublish;
    broker.authorizeSubscribe = authorizeSubscribe;
});

broker.on('clientConnected', function (client: any) {
    // console.log("Client connected: ", client);
    console.log('Client connected.');
});

broker.on('published', function (packet, client: any) {
    let topic = packet.topic;
    if (packet.topic.split('/')[0] === '$SYS') {
    return;
    }
    console.log('Published');
    let payload = JSON.parse(packet.payload.toString());
    createReading(client.username, payload);
    //console.log(payload)
});

// Accepts the connection if the username and password are valid
var authenticate = function (client: any, username: any, password: any, callback: any) {
    console.log('Authenticated', username);
    // check auth for username and pass
    if (!username || !password) {
    callback('Credentials not valid', null);
    return;
    }
    let passwordHash = crypto.createHash('sha256').update(password).digest('hex');
    Device.findOne({ username: username, password: passwordHash }, { devices: 1, type: 1, _id: 0 })
    .then((document) => {
        if (!document) {
        throw 401;
        }
        client.username = username;
        client.devices = document.devices;
        client.type = document.type;
        callback(null, document.devices);
        console.log('Device authenticated.');
    })
    .catch((err) => {
        console.log('??????', err);
        callback('Credentials not valid', null);
        console.log('Not authorized.');
    });
};

// In this case the client authorized as alice can publish to /users/alice taking
// the username from the topic and verifing it is the same of the authorized user
var authorizePublish = function (client: any, topic: any, payload: any, callback: any) {
    console.log('Authorization for publish', client.username);
    if (client.username === topic.split('/')[1]) {
    callback(null, true);
    } else {
    callback('Not allowed to publish', null);
    }
};

// In this case the client authorized as alice can subscribe to /users/alice taking
// the username from the topic and verifing it is the same of the authorized user
var authorizeSubscribe = function (client: any, topic: any, callback: any) {
    console.log('Authorization for subscribe', client.username);

    let topicList = topic.split('/');
    let collection = topicList[0];
    let observer = topicList[1];

    switch (collection) {
    case 'users':
        // TODO: implement security
        console.log('Allowed to subscribe', client.devices, observer);
        callback(null, true);
        break;

    case 'devices':
        if (client.username === topicList[1] || client.devices.indexOf(observer) !== -1) {
        console.log('Allowed to subscribe', client.devices, observer);
        callback(null, true);
        } else {
        console.log('NOT allowed to subscribe', client.devices, observer);
        callback('Not allowed to subscribe', null);
        }
        break;

    case 'default':
        console.log('Not implemented');
        callback('Not allowed to subscribe', null);
    }
};


                                            
                                                </code>
                                            </pre>
                                        </td>
                                    </tr>
                                </table>
                                <br>

                            </div>


                            <div class="request">

                                <h4 id="api-app">
                                    This is the main file of our backend app.
                                    <a href="#request-readings-retrieve-readings-of-a-device"><i class="glyphicon glyphicon-link"></i></a>
                                </h4>
                                <table class="table table-bordered">
                                    <tr>
                                        <td class="response-text-sample" colspan="1">
                                            <pre>
                                                <code>

import express from "express";

const app = express();

// const config = require("dotenv").config();
const csrf = require('csurf');
const _db = require('./db');
const cors = require('cors');
const boolParser = require('express-query-boolean');

import bodyParser from "body-parser";
import compression from 'compression'

import accessRoutes from "./routes/accessRoutes";
import devicesRoutes from "./routes/devicesRoutes";
import usersRoutes from "./routes/usersRoutes";
import rolesRoutes from "./routes/rolesRoutes";

// this should be handled differently in deployment
app.use(cors());

app.use(bodyParser.json());
app.use(bodyParser.urlencoded({ extended: true }));
app.use(compression())
app.use(boolParser());
app.options("*", function (req : any, res : any, next : any) {
    res.header('Access-Control-Allow-Origin', 'smartair.com');
    res.header('Access-Control-Allow-Methods', 'GET,PATCH,POST,DELETE,OPTIONS');
    res.header('Access-Control-Allow-Credentials', true);
    res.header('Access-Control-Allow-Headers', 'Origin, Content-Type, Authorization, Content-Length, X-Requested-With, Access-Control-Allow-Headers, Access-Control-Allow-Origin');
    res.sendStatus(204);
});

app.use('/api/access', accessRoutes);
app.use('/api/devices', devicesRoutes);
app.use('/api/users', usersRoutes);
app.use('/api/roles', rolesRoutes);

export default app; 
                                                </code>
                                            </pre>
                                        </td>
                                    </tr>
                                </table>
                                <br>

                            </div>


                            <div class="request">

                                <h4 id="api-server">
                                    The web server:
                                    <a href="#request-readings-retrieve-readings-of-a-device"><i class="glyphicon glyphicon-link"></i></a>
                                </h4>
                                <table class="table table-bordered">
                                    <tr>
                                        <td class="response-text-sample" colspan="1">
                                            <pre>
                                                <code>

import app from "./app";

const PORT = Number(process.env.PORT) || 3000;

const server = app.listen(PORT, function () {
    console.log('Express server listening on port ' + PORT);
});
                                                </code>
                                            </pre>
                                        </td>
                                    </tr>
                                </table>
                                <br>

                            </div>


                            <div class="request">

                                <h4 id="api-database">
                                    Database connectivity is done as following.
                                    <a href="#request-readings-retrieve-readings-of-a-device"><i class="glyphicon glyphicon-link"></i></a>
                                </h4>
                                <table class="table table-bordered">
                                    <tr>
                                        <td class="response-text-sample" colspan="1">
                                            <pre>
                                                <code>

import mongoose from "mongoose";

mongoose.Promise = global.Promise;
mongoose.set("useCreateIndex", true);

function connect() {
    mongoose.connect("mongodb://localhost:27017/smartair?retryWrites=true&w=majority",
    { user: process.env.MONGO_USER,
    pass: process.env.MONGO_PW,
    useNewUrlParser: true,
    useUnifiedTopology: true,
    useFindAndModify: false })
    .then(
        (connection : any) => {
        console.log('Database is connected')
        return connection;
        },
        (err : any) => { console.log('Cannot connect to the database' + err) }
    );
}

exports.connection = connect();     
                                                </code>
                                            </pre>
                                        </td>
                                    </tr>
                                </table>
                                <br>

                            </div>


                            <div class="request">

                                <h4 id="api-models">
                                    We defined a total of 3 models: User, Role and Device.
                                    <a href="#request-readings-retrieve-readings-of-a-device"><i class="glyphicon glyphicon-link"></i></a>
                                </h4>
                                <table class="table table-bordered">
                                    <tr>
                                        <td class="response-text-sample" colspan="1">
                                            <pre>
                                                <code>
import mongoose, { Query } from "mongoose";
import crypto from "crypto";

const Schema = mongoose.Schema;

export interface IUser extends mongoose.Document {
    username: string,
    firstName: string,
    lastName: string,
    password: string,
    email: string,
    roles: [string],
    active: boolean,
    session: Date,
    needsRelog: boolean,
    devices: [string]
}

export interface IUserQuery extends Query<any> {
    _update: IUser,
    _conditions: IUser
}

const User = new Schema({
    username: {
        type: String,
        unique: true,
        required: true
    },
    firstName: {
        type: String,
        required: true
    },
    lastName: {
        type: String,
        required: true
    },
    email: {
        type: String,
        unique: true,
        required: true
    },
    password: {
        type: String,
        required: true
    },
    roles: {
        type: [String],
        required: true,
        default: []
    },
    active: {
        type: Boolean,
        default: false
    },
    session: {
        type: Date,
        default: undefined
    },
    needsRelog: {
        type: Boolean,
        default: false
    },
    devices: {
        type: [String],
        default: []
    }
}, {
    collection: 'users'
});

User.pre<IUser>('save', true, async function (next: any, done: any) {
    let hash = crypto.createHash('sha256').update(this.password).digest("hex");
    this.password = hash;
    next();
    done();
});

User.pre<IUserQuery>('findOneAndUpdate', true, async function (next: any, done: any) {
    let update = this._update;
    let conditions = this._conditions;
    let username = conditions.username;
    let session = update.session;
    // mongoose.model<IUser>('User', User).updateOne( // way to make user relog
    //     { username: username },
    //     { $set: { needsRelog: true } },
    //     { multi: true }
    // )
    next();
    done();
});

export var UserModel = mongoose.model<IUser>('User', User);
                                            
                                                </code>
                                            </pre>
                                        </td>
                                    </tr>
                                </table>
                                <br>

                                <table class="table table-bordered">
                                    <tr>
                                        <td class="response-text-sample" colspan="1">
                                            <pre>
                                                <code>

import mongoose, { Query } from "mongoose";
import { UserModel as User } from "../models/User";

const Schema = mongoose.Schema;

export interface IRole extends mongoose.Document {
    name: string,
    accessList: Array<Object>
}

export interface IRoleQuery extends Query<any> {
    _update: IRole,
    _conditions: IRole
}

const Role = new Schema({
    name: {
        type: String,
        unique: true,
        required: true
    },
    accessList: {
        type: Array,
        required: true,
        default: []
    }
}, {
    collection: 'roles'
});

Role.pre<IRole>('save', true, async function (next, done) {
    if (this.accessList.length <= 0) {
        this.invalidate("Role", "Accesslist cannot be empty.");
        done(new Error("Accesslist cannot be empty."));
    }
    next();
    done();
});

Role.pre<IRoleQuery>('findOneAndUpdate', true, async function (next, done) {
    let roleName = this._conditions.name;
    User.updateMany( // way to make user relog
        { roles: { $in: [roleName] } },
        { $set: { needsRelog: true } },
        { multi: true }
    )
        .then(function () {
            next();
            done();
        })
        .catch(function (exception: mongoose.Error | undefined) {
            done(exception);
        });
});

Role.pre<IRoleQuery>('findOneAndDelete', true, async function (next, done) {
    let roleName = this._conditions.name;
    console.log("Removing role", roleName);
    User.updateMany( // removing role for all users and making user relog
        { roles: { $in: [roleName] } },
        {
            $pull: { roles: roleName },
            $set: { needsRelog: true }
        },
        { multi: true }
    )
        .then(function () {
            next();
            done();
        })
        .catch(function (exception: mongoose.Error | undefined) {
            done(exception);
        });
});

export var RoleModel = mongoose.model<IRole>('Role', Role);

                                                </code>
                                            </pre>
                                        </td>
                                    </tr>
                                </table>
                                <br>

                                <table class="table table-bordered">
                                    <tr>
                                        <td class="response-text-sample" colspan="1">
                                            <pre>
                                                <code>
import mongoose, { Query } from "mongoose";
import crypto from "crypto";

const Schema = mongoose.Schema;

export interface IDevice extends mongoose.Document {
    username: string,
    password: string,
    active: boolean,
    type: string,
    devices: [string]
}

export interface IUserQuery extends Query<any> {
    _update: IDevice,
    _conditions: IDevice
}

const Device = new Schema({
    username: {
        type: String,
        unique: true,
        required: true
    },
    password: {
        type: String,
        required: true
    },
    active: {
        type: Boolean,
        default: false
    },
    type: {
        type: String,
        required: true,
        default: undefined
    },
    devices:{
        type: [String],
        default: []
    }
}, {
    collection: 'devices'
});

Device.pre<IDevice>('save', true, async function (next, done) {
    let hash = crypto.createHash('sha256').update(this.password).digest("hex");
    this.password = hash;
    next();
    done();
});

export var DeviceModel = mongoose.model<IDevice>('Device', Device);
                                            
                                                </code>
                                            </pre>
                                        </td>
                                    </tr>
                                </table>
                                <br>

                            </div>


                            <div class="request">

                                <h4 id="api-routes">
                                    We defined 4 route files, each defining its own routes.
                                    <a href="#request-readings-retrieve-readings-of-a-device"><i class="glyphicon glyphicon-link"></i></a>
                                </h4>
                                <table class="table table-bordered">
                                    <tr>
                                        <td class="response-text-sample" colspan="1">
                                            <pre>
                                                <code>
import * as express from 'express';
import * as AccessController from '../controllers/AccessController';

const routes = express.Router();

routes.route('/login').post(AccessController.login);

routes.route('/password/recovery').post(AccessController.recoverPassword);

routes.route('/password/change/:username').post(AccessController.changePassword);

routes.route('/password/reset/:username').post(AccessController.resetPassword);
export default routes;

                                            
                                                </code>
                                            </pre>
                                        </td>
                                    </tr>
                                </table>
                                <br>

                                <table class="table table-bordered">
                                    <tr>
                                        <td class="response-text-sample" colspan="1">
                                            <pre>
                                                <code>
import * as express from "express";
import * as UsersController from "../controllers/UsersController";
import checkAuth from "../middleware/checkAuth";
import { checkCache } from "../redis";

const routes = express.Router();

routes.route('/').get(checkCache, UsersController.retrieveUsers);

routes.route('/:username').get(checkCache, UsersController.retrieveUser);

routes.route('/').post(UsersController.createUser);

routes.route('/:username').patch(UsersController.updateUser);

routes.route('/:username').delete(UsersController.deleteUser);

export default routes;

                                            
                                                </code>
                                            </pre>
                                        </td>
                                    </tr>
                                </table>
                                <br>

                                <table class="table table-bordered">
                                    <tr>
                                        <td class="response-text-sample" colspan="1">
                                            <pre>
                                                <code>
import * as express from "express";
import checkAuth from "../middleware/checkAuth";
import * as RolesController from "../controllers/RolesController";
import { checkCache } from "../redis";

const routes = express.Router();

routes.route('/').get(checkCache, RolesController.retrieveRoles);

routes.route('/:name').get(checkCache, RolesController.retrieveRole);

routes.route('/').post(RolesController.createRole);

routes.route('/:name').patch(RolesController.updateRole);

routes.route('/:name').delete(RolesController.deleteRole);

export default routes;

                                            
                                                </code>
                                            </pre>
                                        </td>
                                    </tr>
                                </table>
                                <br>

                                <table class="table table-bordered">
                                    <tr>
                                        <td class="response-text-sample" colspan="1">
                                            <pre>
                                                <code>
import * as express from "express";
import checkAuth from "../middleware/checkAuth";
import * as DevicesController from "../controllers/DevicesController";
import { checkCache } from "../redis";

const routes = express.Router();

routes.route('/').get(checkCache, DevicesController.retrieveDevices);

routes.route('/:username').get(DevicesController.retrieveDevice);

routes.route('/').post(DevicesController.createDevice);

routes.route('/:username').patch(DevicesController.updateDevice);

routes.route('/:username').delete(DevicesController.deleteDevice);

routes.route('/:username/readings').get(checkCache, DevicesController.retrieveReadings);

export default routes;

                                            
                                                </code>
                                            </pre>
                                        </td>
                                    </tr>
                                </table>
                                <br>

                            </div>


                            <div class="request">

                                <h4 id="api-controllers">
                                    We defined 4 files, each for a route. Each file contains multiple controllers.
                                    <a href="#request-readings-retrieve-readings-of-a-device"><i class="glyphicon glyphicon-link"></i></a>
                                </h4>
                                <table class="table table-bordered">
                                    <tr>
                                        <td class="response-text-sample" colspan="1">
                                            <pre>
                                                <code>
import { UserModel as User } from '../models/User';
import { errHandler } from '../utils/errHandlingUtils';
import crypto from 'crypto';
import { RoleModel as Role } from '../models/Role';
const sendmail = require('sendmail')();

const jwt = require('jsonwebtoken');
const issuer = 'Smart Air';
const regex = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;

const signOptions = {
    issuer: issuer,
    expiresIn: 43200000, // 12h
};

export function login(req: any, res: any) {
    const auth = req.body.auth;
    try {
    if (!auth || !auth.username || !auth.password) {
        throw 401;
    }
    } catch (err) {
    console.log(err);
    errHandler(err, res);
    return;
    }

    const username = auth.username;
    const password = auth.password;

    let time = Date.now();
    let passwordHash = crypto.createHash('sha256').update(password).digest('hex');

    console.log(username, password);
    User.findOneAndUpdate({ username: username, password: passwordHash }, { session: new Date(time) }, { new: true })
    .then((document: any) => {
        if (!document) {
        throw 401;
        }
        let user = JSON.parse(JSON.stringify(document));
        delete user.__v;
        delete user._id;
        delete user.password;

        let roles: [string] = user.roles;
        let roleDocuments: any[] = [];
        for (let i = 0; i < roles.length; i++) {
        Role.findOne({ name: roles[i] }, { _id: 0, __v: 0 }).then((roleDocument) => {
            roleDocuments.push(roleDocument);
            if (roleDocuments.length == roles.length) {
            user.roles = roleDocuments;
            const token = jwt.sign({ user: user, iat: time }, process.env.PRIVATE_KEY, signOptions);
            console.log('USER LOGGED IN!');
            res.status(200).send({
                user: user,
                token: token,
            });
            }
        });
        }
    })
    .catch((err) => errHandler(err, res));
}

export function recoverPassword(req: any, res: any) {
    const identification = req.body.identification;
    try {
    if (!identification) {
        throw 400;
    }
    } catch (err) {
    console.log(err);
    errHandler(err, res);
    return;
    }

    let time = Date.now();
    let tempPassword = time.toString();
    let passwordHash = crypto.createHash('sha256').update(tempPassword).digest('hex');

    let query;
    if (isMail(identification)) {
    query = {
        email: identification,
    };
    } else {
    query = {
        username: identification,
    };
    }

    User.findOneAndUpdate(query, { password: passwordHash, active: false }, { new: true })
    .then((document: any) => {
        if (!document) {
        throw 401;
        }
        let user = JSON.parse(JSON.stringify(document));
        let link = 'http://smartair.com/#/changepassword/' + document.username;
        console.log('Sending mail to ' + document.email);
        sendmail(
        {
            from: 'no-reply@smartair.com',
            to: document.email,
            subject: 'Activate your account',
            html:
            '&lt;p&gt; Dear ' +document.username +
            ', &lt;br&gt;Your password has just been resetted, so now you have to change your temporary password (' +
            tempPassword +
            ') using the following link:&lt;br&gt; ' +
            link +
            '&lt;br&gt;&lt;/p&gt;',
        },
        function (err: any, reply: any) {
            console.log(err && err.stack);
            console.dir(reply);
        },
        );
        res.status(200).send();
    })
    .catch((err) => errHandler(err, res));
}

export function changePassword(req: any, res: any) {
    const oldPassword = req.body.oldPassword;
    const newPassword = req.body.newPassword;

    let oldPasswordHash = crypto.createHash('sha256').update(oldPassword).digest('hex');
    let newPasswordHash = crypto.createHash('sha256').update(newPassword).digest('hex');

    const query = {
    username: req.params.username,
    password: oldPasswordHash,
    };

    console.log('Query is', query, oldPassword, newPassword);
    User.findOneAndUpdate(query, { password: newPasswordHash, active: true }, { new: true })
    .then((document: any) => {
        console.log('Document:', document);
        if (!document) {
        console.log('No document returned for this query.');
        throw 401;
        }
        console.log('Returning status 200');
        res.status(200).send();
    })
    .catch((err) => errHandler(err, res));
}

export function resetPassword(req: any, res: any) {
    let time = Date.now();
    let tempPassword = time.toString();
    let passwordHash = crypto.createHash('sha256').update(tempPassword).digest('hex');

    const query = {
    username: req.params.username,
    };

    User.findOneAndUpdate(query, { password: passwordHash, active: false }, { new: true })
    .then((document: any) => {
        if (!document) {
        throw 401;
        }
        let user = JSON.parse(JSON.stringify(document));
        let link = 'http://smartair.com/#/changepassword/' + document.username;
        console.log('Sending mail to ' + document.email);
        sendmail(
        {
            from: 'no-reply@smartair.com',
            to: document.email,
            subject: 'Activate your account',
            html:
            '&lt;p&gt; Dear ' +
            document.username +
            ', &lt;br&gt;Your password has just been resetted by the administrator, so now you`ll have to change your temporary password (' +
            tempPassword +
            ') using the following link:&lt;br&gt; ' +
            link +
            '&lt;br&gt;&lt;/p&gt;',
        },
        function (err: any, reply: any) {
            console.log(err && err.stack);
            console.dir(reply);
        },
        );
        res.status(200).send();
    })
    .catch((err) => errHandler(err, res));
}

function isMail(mail: string) {
    return regex.test(mail.toLowerCase());
}

                                            
                                                </code>
                                            </pre>
                                        </td>
                                    </tr>
                                </table>
                                <br>
                                <table class="table table-bordered">
                                    <tr>
                                        <td class="response-text-sample" colspan="1">
                                            <pre>
                                                <code>
import { UserModel as User } from "../models/User";
import { trimEndSlashes } from "../utils/reqUtils";
import { errHandler } from "../utils/errHandlingUtils";
import { redisClient } from "../redis";
const sendmail = require('sendmail')();

export function retrieveUsers(req: any, res: any) {
    // TODO: FILTER PARAMS !!!
    const query = req.query;

    // TODO: CHECK ACCESS (probably in middleware, not here)
    User.find(query, { _id: 0, __v: 0, password: 0 })
        .then(
            documents => {
                let users = JSON.parse(JSON.stringify(documents));
                var fullUrl = trimEndSlashes(req.protocol + '://' + process.env.HOST + req.originalUrl);
                users.map((user: any) => user.href = fullUrl + '/' + user.username);
                let response = {
                    users: users,
                    count: users.length
                }

                redisClient.set(fullUrl, JSON.stringify(response), 'EX', 30, 'NX');

                res.status(200);
                res.send(response);
            }
        )
        .catch((err) => errHandler(err, res));

}

export function retrieveUser(req: any, res: any) {
    // TODO: FILTER PARAMS !!!
    const query = { "username": req.params.username };
    console.log("Query is", query);
    // TODO: CHECK ACCESS (probably in middleware, not here)
    User.findOne(query, { _id: 0, __v: 0 }) // add password: 0 in options
        .then(
            document => {
                if (!document) {
                    throw (404);
                }
                console.log("Retrieved user", document);
                let user = JSON.parse(JSON.stringify(document));
                var fullUrl = trimEndSlashes(req.protocol + '://' + process.env.HOST + req.originalUrl);
                user.href = fullUrl;

                redisClient.set(fullUrl, JSON.stringify(user), 'EX', 30, 'NX');

                res.status(200);
                res.send(user);
            }
        )
        .catch((err) => errHandler(err, res));

}

export function createUser(req: any, res: any) {
    const user = new User(req.body);
    console.log(user)
    let time = Date.now().toString();
    
    user.password = time;
    let tempPassword = time;

    user.save()
        .then(
            document => {
                if (!document) {
                    throw (404);
                }
                console.log("Created user:", document);
                let user = JSON.parse(JSON.stringify(document));
                delete user._id;
                delete user.__v;
                var fullUrl = trimEndSlashes(req.protocol + '://' + process.env.HOST + req.originalUrl);
                user.href = fullUrl + '/' + user.username;
                res.status(200);
                res.send(user);

                let link = "http://smartair.com/#/changepassword/" + document.username;
                console.log("Sending mail to " + document.email);
                sendmail({
                    from: 'no-reply@smartair.com',
                    to: document.email,
                    subject: 'Activate your account',
                    html: '&lt;p&gt; Dear ' + document.username + ',
                    &lt;br&gt;For gaining full access to your account, you have to change your temporary password ('
                    + tempPassword + ') using the following link:&lt;br&gt; ' + link + '&lt;br&gt;&lt;/p&gt;',
                }, function (err: any, reply: any) {
                    console.log(err && err.stack);
                    console.dir(reply);
                });
            }
        )
        .catch((err) => { console.log(err); errHandler(err, res); });

}

export function updateUser(req: any, res: any) {
    const query = { username: req.params["username"] };
    const update = req.body;
    User.findOneAndUpdate(query, update, { new: true })
        .then(
            document => {
                if (!document) {
                    throw (404);
                }
                let user = JSON.parse(JSON.stringify(document));
                delete user._id;
                delete user.__v;
                var fullUrl = trimEndSlashes(req.protocol + '://' + process.env.HOST + req.originalUrl);
                user.href = fullUrl;
                res.status(200);
                res.send(user);
            }
        )
        .catch((err) => errHandler(err, res));
}

export function deleteUser(req: any, res: any) {
    const query = { username: req.params["username"] };
    User.findOneAndDelete(query)
        .then(
            document => {
                if (!document) {
                    throw (404);
                }
                let user = JSON.parse(JSON.stringify(document));
                delete user._id;
                delete user.__v;
                res.status(200);
                res.send(user);
            }
        )
        .catch((err) => errHandler(err, res));
}

                                            
                                                </code>
                                            </pre>
                                        </td>
                                    </tr>
                                </table>
                                <br>
                                <table class="table table-bordered">
                                    <tr>
                                        <td class="response-text-sample" colspan="1">
                                            <pre>
                                                <code>
import { RoleModel as Role } from "../models/Role";
import { trimEndSlashes } from "../utils/reqUtils";
import { errHandler } from "../utils/errHandlingUtils";
import { redisClient } from "../redis";

export function retrieveRoles (req: any, res: any) {
    // TODO: FILTER PARAMS !!!
    const query = req.query;

    // TODO: CHECK ACCESS (probably in middleware, not here)
    Role.find(query, { _id: 0, __v: 0 })
        .then(
            documents => {
                let roles = JSON.parse(JSON.stringify(documents));
                var fullUrl = trimEndSlashes(req.protocol + '://' + process.env.HOST + req.originalUrl);
                roles.map((role: any) => role.href = fullUrl + '/' + role.name);
                let response = {
                    roles: roles,
                    count: roles.length
                }

                redisClient.set(fullUrl, JSON.stringify(response), 'EX', 30, 'NX');

                res.status(200);
                res.send(response);
            }
        )
        .catch((err) => errHandler(err, res));
}

export function retrieveRole(req: any, res: any) {
    // TODO: FILTER PARAMS !!!
    const query = { "name": req.params.name};

    // TODO: CHECK ACCESS (probably in middleware, not here)
    Role.findOne(query, { _id: 0, __v: 0 })
        .then(
            document => {
                if (!document){
                    throw(404);
                }
                let role = JSON.parse(JSON.stringify(document));
                var fullUrl =trimEndSlashes( req.protocol + '://' + process.env.HOST + req.originalUrl);
                role.href = fullUrl;

                redisClient.set(fullUrl, JSON.stringify(role), 'EX', 10, 'NX');

                res.status(200);
                res.send(role);
            }
        )
        .catch((err) => errHandler(err, res));
}


export function createRole (req: any, res: any) {
    const role = new Role(req.body);
    role.save()
        .then(
            document => {
                if (!document){
                    throw(404);
                }
                let role = JSON.parse(JSON.stringify(document));
                delete role._id;
                delete role.__v;
                var fullUrl = trimEndSlashes(req.protocol + '://' + process.env.HOST + req.originalUrl);
                role.href = fullUrl + '/' + role.name;
                res.status(200);
                res.send(role);
            }
        )
        .catch((err) => errHandler(err, res));

}

export function updateRole(req: any, res: any) {
    const query = { name: req.params["name"]};
    const update = req.body;
    Role.findOneAndUpdate(query, update, { new: true  })
        .then(
            document => {
                if (!document){
                    throw(404);
                }
                let role = JSON.parse(JSON.stringify(document));
                delete role._id;
                delete role.__v;
                var fullUrl = trimEndSlashes(req.protocol + '://' + process.env.HOST + req.originalUrl);
                role.href = fullUrl;
                res.status(200);
                res.send(role);
            }
        )
        .catch((err) => errHandler(err, res));

}

export function deleteRole(req: any, res: any) {
    const query = { name: req.params["name"]};
    Role.findOneAndDelete(query)
        .then(
            document => {
                if (!document){
                    throw(404);
                }
                let role = JSON.parse(JSON.stringify(document));
                delete role._id;
                delete role.__v;
                res.status(200);
                res.send(role);
            }
        )
        .catch((err) => errHandler(err, res));
}
                                            
                                                </code>
                                            </pre>
                                        </td>
                                    </tr>
                                </table>
                                <br>
                                <table class="table table-bordered">
                                    <tr>
                                        <td class="response-text-sample" colspan="1">
                                            <pre>
                                                <code>
import { DeviceModel as Device } from '../models/Device';
import {
    createReading as createElasticReading,
    retrieveReadings as retrieveElasticReadings,
} from '../utils/elasticUtils';
import { trimEndSlashes } from '../utils/reqUtils';
import { errHandler } from '../utils/errHandlingUtils';
import { redisClient } from '../redis';

let cachedDevices: any[] = [];

export function retrieveDevice(req: any, res: any) {
    // TODO: return a device that the user having this token has access to
    // TODO: handle parameters, also handle FIELDS!!!
    const query = { username: req.params.username };

    Device.findOne(query, { _id: 0, __v: 0, password: 0 })
    .then((document) => {
        if (!document) {
        throw 404;
        }
        let device = JSON.parse(JSON.stringify(document));
        var fullUrl = trimEndSlashes(req.protocol + '://' + process.env.HOST + req.originalUrl);
        device.href = fullUrl;

        redisClient.set(fullUrl, JSON.stringify(device), 'EX', 10, 'NX');

        res.status(200);
        res.send(device);
    })
    .catch((err) => errHandler(err, res));
}

export function retrieveDevices(req: any, res: any) {
    // TODO: handle parameters, first filter the params
    const query = req.query;

    // TODO: return all devices that the user having this token has access to
    Device.find(query, { _id: 0, __v: 0, password: 0 })
    .then((documents) => {
        let devices = JSON.parse(JSON.stringify(documents));
        var fullUrl = trimEndSlashes(req.protocol + '://' + process.env.HOST + req.originalUrl);
        devices.map((device: any) => (device.href = fullUrl + '/' + device.username));

        let response = {
        devices: devices,
        count: devices.length,
        };

        redisClient.set(fullUrl, JSON.stringify(response), 'EX', 30, 'NX');

        res.status(200);
        res.send(response);
    })
    .catch((err) => errHandler(err, res));
}

export function createDevice(req: any, res: any) {
    const device = new Device(req.body);
    device
    .save()
    .then((document) => {
        if (!document) {
        throw 404;
        }
        let device = JSON.parse(JSON.stringify(document));
        delete device._id;
        delete device.__v;
        var fullUrl = trimEndSlashes(req.protocol + '://' + process.env.HOST + req.originalUrl) + '/' + device.username;
        device.href = fullUrl;

        res.status(200);
        res.send(device);
    })
    .catch((err) => errHandler(err, res));
}

export function updateDevice(req: any, res: any) {
    const query = { username: req.params['username'] };
    const update = req.body;
    Device.findOneAndUpdate(query, update, { new: true })
    .then((document: any) => {
        if (!document) {
        throw 404;
        }
        let device = JSON.parse(JSON.stringify(document));
        delete device._id;
        delete device.__v;
        var fullUrl = trimEndSlashes(req.protocol + '://' + process.env.HOST + req.originalUrl);
        device.href = fullUrl;
        res.status(200);
        res.send(device);
    })
    .catch((err) => errHandler(err, res));
}

export function deleteDevice(req: any, res: any) {
    const query = { username: req.params['username'] };
    Device.findOneAndDelete(query)
    .then((document) => {
        if (!document) {
        throw 404;
        }
        let device = JSON.parse(JSON.stringify(document));
        delete device._id;
        delete device.__v;
        delete device.password;
        res.status(200);
        res.send(device);
    })
    .catch((err) => errHandler(err, res));
}

// ex: GET /devices/4134151/readings
export function retrieveReadings(req: any, res: any) {
    const device = req.params.username;
    const from = req.query['from'];
    const to = req.query['to'];

    console.log('Retrieving readings of device ' + device + '...');
    retrieveElasticReadings(device, from, to)
    .then((resolved: any) => {
        let hits = resolved.body.hits;
        if (!hits) {
        let response = {
            readings: [],
            count: 0,
        };
        res.status(200);
        res.send(response);
        return;
        }
        hits = hits.hits.map((element: any) => element._source);
        let response = {
        readings: hits,
        count: hits.length,
        };

        if (to !== null && from !== null) {
        console.log('Not from cache with dates specified');
        var fullUrl = trimEndSlashes(req.protocol + '://' + process.env.HOST + req.originalUrl);
        redisClient.set(fullUrl, JSON.stringify(response), 'EX', 10, 'NX');
        } else {
        console.log('Not from cache with dates not specified');
        }

        res.status(200);
        res.send(response);
    })
    .catch((err: any) => {
        console.log(err);
        errHandler(err, res);
    });
}

                                            
                                                </code>
                                            </pre>
                                        </td>
                                    </tr>
                                </table>
                                <br>

                            </div>


                            <div class="request">

                                <h4 id="api-caching">
                                    Caching middleware with Redis
                                    <a href="#request-readings-retrieve-readings-of-a-device"><i class="glyphicon glyphicon-link"></i></a>
                                </h4>
                                <table class="table table-bordered">
                                    <tr>
                                        <td class="response-text-sample" colspan="1">
                                            <pre>
                                                <code>

const redis = require('redis');
import { trimEndSlashes } from './utils/reqUtils';

const PORT = 6379;
const client = redis.createClient(PORT);

// Middleware Function to Check Cache
export const checkCache = (req: any, res: any, next: any) => {
    const fullUrl = trimEndSlashes(req.protocol + '://' + process.env.HOST + req.originalUrl);
    console.log(fullUrl);
    // get value for key = fullUrl
    client.get(fullUrl, (err: any, value: any) => {
    if (err) {
        console.log(err);
        res.status(500).send(err);
    }
    if (value !== null) {
        // no match found
        res.send(JSON.parse(value));
    } else {
        next(); // proceed to next middleware function
    }
    });
};

export var redisClient = client;

                                                </code>
                                            </pre>
                                        </td>
                                    </tr>
                                </table>
                                <br>

                            </div>


                            <div class="request">

                                <h4 id="api-authentication">
                                    Authentication for users
                                    <a href="#request-readings-retrieve-readings-of-a-device"><i class="glyphicon glyphicon-link"></i></a>
                                </h4>
                                <table class="table table-bordered">
                                    <tr>
                                        <td class="response-text-sample" colspan="1">
                                            <pre>
                                                <code>
import { getTokenFromHeaders } from "../utils/reqUtils";
import { UserModel as User } from "../models/User";
import { errHandler } from "../utils/errHandlingUtils";

const jwt = require('jsonwebtoken');

export default function(req: any, res: any, next: any) {
    const token = getTokenFromHeaders(req.headers["authorization"]);
    if (!token) {
        errHandler(401, res);
    }

    try {
        jwt.verify(token, process.env.PRIVATE_KEY);
        const decodedToken = jwt.decode(token);
        let exp = decodedToken.exp;
        let iat = decodedToken.iat;
        let username = decodedToken.client.username;

        // expiration
        let time = Date.now();
        if (time > exp) {
            throw (401);
        }

        User.findOne({ username: username }, { session: 1 })
            .then(
                document => {
                    if (!document) {
                        throw (401);
                    }
                    let session = document?.session;
                    if (iat < session) {
                        throw (401);
                    }
                    next();
                }
            )
            .catch((err) => errHandler(err, res));

    } catch (ex) {
        //if invalid token
        errHandler(401, res);
    }
}
                                            
                                                </code>
                                            </pre>
                                        </td>
                                    </tr>
                                </table>
                                <br>

                            </div>


                            <!--

                    -->






                            <!--

                        -->


                            <div class="endpoints-group">
                                <h3 id="api-utils">
                                    Some files from the utils folder.
                                    <a href="#api-utils"><i class="glyphicon glyphicon-link"></i></a>
                                </h3>

                                <div></div>



                                <div class="request">

                                    <h4 id="node-elastic">
                                        Elasticsearch logic goes in here.
                                        <a href="#request-readings-retrieve-readings-of-a-device"><i class="glyphicon glyphicon-link"></i></a>
                                    </h4>

                                    <table class="table table-bordered">
                                        <tr>
                                            <td class="response-text-sample" colspan="1">
                                                <pre><code>
const { Client } = require('@elastic/elasticsearch');

// Cloud way

const client = new Client({
    node: 'https://elastic:' + process.env.ELASTICSEARCH_PW + process.env.ELASTICSEARCH_CLOUD_URL,
});

// Local way
//const client = new Client({
// node: 'http://localhost:9200',
// auth: {
//     username: 'elastic',
//     password: process.env.ELASTICSEARCH_PW
// }
//});

// console.log(client);

export interface Readings {
    general: {
    humidity: number;
    temperature: number;
    };
    hazardous: {
    vibration: number;
    };
    poisonous: {
    co: number;
    ch4: number;
    smoke: number;
    };
}

export function createReading(device: string, readings: Readings) {

    return client.index({
    index: 'readings',
    body: {
        device: device,
        date: new Date(),
        values: readings,
    },
    });
}

export function retrieveReadings(device: string, from: Date, to: Date) {

    return client.search({
    index: 'readings',
    filterPath: 'hits.hits._source',
    size: 1000,
    body: {
        query: {
        bool: {
            must: [
            {
                match: {
                device: device,
                },
            },
            ],
            filter: [
            {
                range: {
                date: {
                    gte: from,
                    lte: to,
                },
                },
            },
            ],
        },
        },
        _source: {
        excludes: ['device'],
        },
    },
    });
}
                                                
                                    </code></pre>
                                            </td>
                                        </tr>
                                    </table>

                                    <br>
                                    <h4 id="node-errhandler">

                                        <a href="#request-readings-retrieve-readings-of-a-device"><i class="glyphicon glyphicon-link"></i></a>
                                    </h4>

                                    <table class="table table-bordered">
                                        <tr>
                                            <td class="response-text-sample" colspan="2">
                                                <pre><code>
// default errHandler, might add some others but atm this one works just fine
export function errHandler(err: any, res: any) {
    let statusCode = 400;
    if (!isNaN(err)) {
        statusCode = err;
    }
    res.status(statusCode).send();
}
                                    </code></pre>
                                            </td>
                                        </tr>
                                    </table>

                                    <br>
                                    <h4 id="node-requtils">

                                        <a href="#request-readings-retrieve-readings-of-a-device"><i class="glyphicon glyphicon-link"></i></a>
                                    </h4>

                                    <table class="table table-bordered">
                                        <tr>
                                            <td class="response-text-sample" colspan="2">
                                                <pre><code>
export function trimEndSlashes(url: string) {
    return url.replace(/\/+$/, "");
}

export function getTokenFromHeaders(authorization: string) {
    if (authorization && authorization.length > 7)
        return authorization.slice(7); // slicing 'Bearer ' from the header
}
                                    </code></pre>
                                            </td>
                                        </tr>
                                    </table>
                                </div>


                                <!--

                    -->




                                <!--

                        -->


                                <div class="endpoints-group">
                                    <h3 id="folder-python">
                                        Python code
                                        <a href="#folder-python"><i class="glyphicon glyphicon-link"></i></a>
                                    </h3>

                                    <div></div>



                                    <div class="request">

                                        <h4 id="smartair-script">
                                            This is the main script that we run and then input a username, a password and other things.
                                            <a href="#request-readings-retrieve-readings-of-a-device"><i class="glyphicon glyphicon-link"></i></a>
                                        </h4>

                                        <table class="table table-bordered">
                                            <tr>
                                                <td class="response-text-sample" colspan="1">
                                                    <pre><code>
from getpass import getpass
import os
import json
import time
import requests
import sense


def main():
    print("/=========================/")
    print("Welcome to the SmartAir ecosystem!")
    time.sleep(1)
    username = input("Device username:")
    password = getpass("Device password:")
    owner = None

    print("/=========================/")

    if (username and password):
        os.environ["USERNAME"] = username
        os.environ["PASSWORD"] = password

        if (owner):
            os.environ["OWNER"] = owner

        sense.main()

    else:
        print('Please provide valid username and password.')


if __name__ == "__main__":
    main()
                                                
                                        </code></pre>
                                                </td>
                                            </tr>
                                        </table>
                                        <br>
                                        <h4 id="sense-script">
                                            This is the core script that is called by the previous one. It is the basis of the whole project.
                                            <a href="#request-readings-retrieve-readings-of-a-device"><i class="glyphicon glyphicon-link"></i></a>
                                        </h4>

                                        <table class="table table-bordered">
                                            <tr>
                                                <td class="response-text-sample" colspan="2">
                                                    <pre><code>
from grove.gpio import GPIO
from grove.adc import ADC
from grove.button import Button
from grove.factory import Factory
from subprocess import call
import bme680 as bm
import paho.mqtt.client as paho
import sys
import os
import simplejson
import time
import math
import mraa

broker = "167.71.34.169"
port = 9001
sleep_time = 3

LANGUAGE = "en"
# LANGUAGE = "fr"

SMOKE_LIMIT = 100
GAS_LIMIT = 5
CO_LIMIT = 100

RL_VALUE = 5

GAS_CH4 = 0
GAS_CO = 1
GAS_SMOKE = 2

CH4Curve = [2.3, 0.47, -0.36]
COCurve = [2.3, 0.72, -0.34]
SmokeCurve = [2.3, 0.53, -0.44]

Ro = 10

DIGITAL_INPUT_PIN = 5
DIGITAL_OUTPUT_PIN = 16
PWM_PIN = 12
UART_PIN = 14
ANALOG_PIN = 0


class GroveGasSensorMQ2:
    def __init__(self, channel):
        self.channel = channel
        self.adc = ADC()

    @property
    def MQ2(self):
        value = self.adc.read_raw(self.channel)
        return value


def MQResistanceCalculation(raw_adc):
    return RL_VALUE*(4095-raw_adc)/raw_adc


def MQGetGasPercentage(rs_ro_ratio, gas_id):
    if (gas_id == GAS_CH4):
        return MQGetPercentage(rs_ro_ratio, CH4Curve)
    elif (gas_id == GAS_CO):
        return MQGetPercentage(rs_ro_ratio, COCurve)
    elif (gas_id == GAS_SMOKE):
        return MQGetPercentage(rs_ro_ratio, SmokeCurve)

    return 0


def MQGetPercentage(rs_ro_ratio, pcurve):
    return pow(10, (((math.log(rs_ro_ratio, 10)-pcurve[1])/pcurve[2])+pcurve[0]))


class GroveBME680Sensor(object):
    def __init__(self):
        snr = bm.BME680(bm.I2C_ADDR_PRIMARY)

        # over sampling
        snr.set_humidity_oversample(bm.OS_2X)
        snr.set_pressure_oversample(bm.OS_4X)
        snr.set_temperature_oversample(bm.OS_8X)
        snr.set_filter(bm.FILTER_SIZE_3)
        snr.set_gas_status(bm.ENABLE_GAS_MEAS)

        snr.set_gas_heater_temperature(320)
        snr.set_gas_heater_duration(150)
        snr.select_gas_heater_profile(0)

        # Initial readings
        snr.get_sensor_data()
        snr.get_sensor_data()
        snr.get_sensor_data()

        self.snr = snr

    def read(self):
        if self.snr.get_sensor_data():
            return self.snr.data
        return None


def getCH4(mq2Reading):
    return MQGetGasPercentage(MQResistanceCalculation(mq2Reading)/Ro, GAS_CH4)


def getCO(mq2Reading):
    return MQGetGasPercentage(MQResistanceCalculation(mq2Reading)/Ro, GAS_CO)


def getSmoke(mq2Reading):
    return MQGetGasPercentage(MQResistanceCalculation(mq2Reading)/Ro, GAS_SMOKE)


def getTemperature(bme680Reading):
    return bme680Reading.temperature


def getPressure(bme680Reading):
    return bme680Reading.pressure


def getHumidity(bme680Reading):
    return bme680Reading.humidity


def getGasResistance(bme680Reading):
    return bme680Reading.gas_resistance


def isVibrating(value):
    return not value


def getIAQ(gasResistance, humidity):
    return math.log(gasResistance, 10) + 0.04*humidity


def sampleSensorsData(MQ2Sensor, BME680Sensor):
    sumCH4 = 0
    sumCO = 0
    sumSmoke = 0
    sumTemperature = 0
    sumHumidity = 0
    sumPressure = 0
    sumGasResistance = 0

    for i in range(0, 10):
        mq2Reading = MQ2Sensor.MQ2
        bme680Reading = BME680Sensor.read()

        sumCH4 = sumCH4 + getCH4(mq2Reading)
        sumCO = sumCO + getCO(mq2Reading)
        sumSmoke = sumSmoke + getSmoke(mq2Reading)

        if bme680Reading:
            sumTemperature = sumTemperature + getTemperature(bme680Reading)
            sumHumidity = sumHumidity + getHumidity(bme680Reading)
            sumPressure = sumPressure + getPressure(bme680Reading)
            if bme680Reading.heat_stable:
                sumGasResistance = sumGasResistance + \
                    getGasResistance(bme680Reading)
        time.sleep(0.1)

    CH4 = sumCH4/10
    CO = sumCO/10
    Smoke = sumSmoke/10
    Temperature = sumTemperature/10
    Humidity = sumHumidity/10
    Pressure = sumPressure/10
    GasResistance = sumGasResistance/10

    sensorsData = {
        "CH4": CH4,
        "CO": CO,
        "Smoke": Smoke,
        "Temperature": Temperature,
        "Humidity": Humidity,
        "Pressure": Pressure,
        "GasResistance": GasResistance
    }

    return sensorsData


class GroveSW420Sensor():
    def __init__(self, channel):
        self.channel = channel
        self.sensor = GPIO(channel, GPIO.IN)

    def read(self):
        return self.sensor.read()


class DigitalLedButton(object):
    def __init__(self, pin, invert_pins=False):
        output_pin = pin
        input_pin = pin + 1
        if (invert_pins):  # handling UART inversion of Tx and Rx
            output_pin, input_pin = input_pin, output_pin

        # High = LED is HIGH
        self.led = Factory.getOneLed("GPIO-HIGH", output_pin)
        # Low = Button is pressed
        self.__btn = Factory.getButton("GPIO-LOW", input_pin)
        self.__on_event = None
        self.__btn.on_event(self, DigitalLedButton.__handle_event)

    @property
    def on_event(self):
        return self.__on_event

    @on_event.setter
    def on_event(self, callback):
        if not callable(callback):
            return
        self.__on_event = callback

    def __handle_event(self, evt):
        if callable(self.__on_event):  # case where it is customized
            self.__on_event(evt['index'], evt['code'], evt['time'])
            return

        # no customization so default settings
        self.led.brightness = self.led.MAX_BRIGHT
        event = evt['code']
        if event & Button.EV_SINGLE_CLICK:
            self.led.light(True)
            print("turn on  LED")
        elif event & Button.EV_DOUBLE_CLICK:
            self.led.blink()
            print("blink    LED")
        elif event & Button.EV_LONG_PRESS:
            self.led.light(False)
            print("turn off LED")


def get_path_from_action(action):
    if (action == "attention"):
        return "wav_files/" + LANGUAGE + "/attention.wav"
    elif (action == "co"):
        return "wav_files/" + LANGUAGE + "/co.wav"
    elif (action == "gas"):
        return "wav_files/" + LANGUAGE + "/gas.wav"
    elif (action == "smoke"):
        return "wav_files/" + LANGUAGE + "/smoke.wav"
    elif (action == "earthquake"):
        return "wav_files/" + LANGUAGE + "/earthquake.wav"
    elif (action == "opening_windows"):
        return "wav_files/" + LANGUAGE + "/opening_windows.wav"
    elif (action == "closing_windows"):
        return "wav_files/" + LANGUAGE + "/closing_windows.wav"
    elif (action == "cover_yourself"):
        return "wav_files/" + LANGUAGE + "/cover_yourself.py"


def play_sound(action):
    call(["aplay", get_path_from_action(action)])


def warn_if_necessary(data, redButton, blueButton, yellowButton):
    co = data["poisonous"]["co"]
    smoke = data["poisonous"]["smoke"]
    gas = data["poisonous"]["ch4"]
    vibration = data["hazardous"]["vibration"]

    if (smoke > SMOKE_LIMIT):
        play_sound("attention")
        play_sound("smoke")
        play_sound("closing_windows")
        redButton.led.blink()
    elif (co > CO_LIMIT):
        play_sound("attention")
        play_sound("co")
        play_sound("opening_windows")
        blueButton.led.blink()
    elif (gas > GAS_LIMIT):
        play_sound("attention")
        play_sound("gas")
        play_sound("opening_windows")
        yellowButton.led.blink()
    if (vibration == True):
        play_sound("attention")
        play_sound("earthquake")
        play_sound("cover_yourself")
        redButton.led.blink()
        blueButton.led.blink()
        yellowButton.led.blink()


def on_connect(client, userdata, flags, rc):
    if rc == 0:
        print("Connected OK")
        client.connected_flag = True  # set flag
    else:
        print("Bad connection Returned code=", rc)
        client.bad_connection_flag = True


def on_disconnect(client, userdata, rc):
    print("Disconnecting reason " + str(rc))
    client.connected_flag = False
    client.disconnect_flag = True


def on_message(client, data, msg):
    print(msg.topic + " " + str(msg.qos) + " " + str(msg.payload))


def on_publish(client, data, mid):
    print("mid: " + str(mid))


def on_subscribe(client, data, mid, granted_qos):
    print("Subscribed: " + str(mid) + " " + str(granted_qos))


def on_log(client, data, level, string):
    print("log: " + string)


def main():
    MQ2Sensor = GroveGasSensorMQ2(ANALOG_PIN)
    BME680Sensor = GroveBME680Sensor()
    SW420Sensor = GroveSW420Sensor(DIGITAL_INPUT_PIN)
    redButton = DigitalLedButton(DIGITAL_OUTPUT_PIN)
    yellowButton = DigitalLedButton(PWM_PIN)
    blueButton = DigitalLedButton(UART_PIN, True)

    username = os.environ["USERNAME"]
    password = os.environ["PASSWORD"]
    topic = "devices/" + username
    print("Sensing...")

    client = paho.Client(client_id=username, transport="websockets")
    client.username_pw_set(username=username, password=password)
    client.connected_flag = False
    client.bad_connection_flag = False

    client.on_connect = on_connect
    client.on_disconnect = on_disconnect
    client.on_message = on_message
    client.on_publish = on_publish
    client.on_subscribe = on_subscribe
    client.on_log = on_log

    # thread triggers callbacks based on received messages
    client.loop_start()

    print("Connecting to broker", broker)

    try:
        client.connect(broker, port)
    except e:
        print("Connection failed", e)
        exit(1)

    while not client.connected_flag:  # waiting for CONNACK message
        print("Waiting for CONNACK...")
        time.sleep(1)

    if client.bad_connection_flag:  # established a connection but it's not OK
        client.loop_stop()
        sys.exit()

    while (True):
        sensorsData = sampleSensorsData(MQ2Sensor, BME680Sensor)
        IAQ = getIAQ(sensorsData["GasResistance"], sensorsData["Humidity"])
        sw420Reading = SW420Sensor.read()

        print('CH4 value: {0} ppm'.format(sensorsData["CH4"]))
        print('CO value: {0} ppm'.format(sensorsData["CO"]))
        print('SMOKE value: {0} ppm'.format(sensorsData["Smoke"]))
        print('Temperature value: {0:.2f} C'.format(
            sensorsData["Temperature"]))
        print('Pressure value: {0:.2f} hPa'.format(sensorsData["Pressure"]))
        print('Humidity value: {0:.2f} %RH'.format(sensorsData["Humidity"]))
        print('Indoor Air Quality: {0} '.format(IAQ))
        print('Vibration: {0}'.format(isVibrating(sw420Reading)))
        print("#####################################")

        # defining a params dict for the parameters to be sent to the API
        data = {
            'general': {
                'temperature': sensorsData["Temperature"],
                'pressure': sensorsData["Pressure"],
                'humidity': sensorsData["Humidity"]
            },
            'hazardous': {
                'vibration': isVibrating(sw420Reading)
            },
            'poisonous': {
                'smoke': sensorsData["Smoke"],
                'co': sensorsData["CO"],
                'ch4': sensorsData["CH4"]
            }
        }

        warn_if_necessary(simplejson.loads(simplejson.dumps(data)), redButton, blueButton, yellowButton)

        ret = client.publish(topic, simplejson.dumps(data), 2)
        time.sleep(sleep_time)


if __name__ == "__main__":
    main()


                                        </code></pre>
                                                </td>
                                            </tr>
                                        </table>
                                    </div>


                                    <!--

                        -->



                                    <!--

                        -->


                                    <div class="endpoints-group">
                                        <h3 id="folder-nginx">
                                            Nginx configuration
                                            <a href="#folder-nginx"><i class="glyphicon glyphicon-link"></i></a>
                                        </h3>

                                        <div></div>



                                        <div class="request">

                                            <h4 id="nginx-main">
                                                This is the main Nginx configuration file.
                                                <a href="#request-readings-retrieve-readings-of-a-device"><i class="glyphicon glyphicon-link"></i></a>
                                            </h4>

                                            <table class="table table-bordered">
                                                <tr>
                                                    <td class="response-text-sample" colspan="1">
                                                        <pre><code>
### Ubuntu compatible nginx config file

user www-data;
worker_processes auto;
pid /run/nginx.pid;
include /etc/nginx/modules-enabled/*.conf;

events {
    worker_connections 768;
    # multi_accept on;
}

http {

    ##
    # Basic Settings
    ##

    sendfile on;
    tcp_nopush on;
    tcp_nodelay on;
    keepalive_timeout 65;
    types_hash_max_size 2048;
    # server_tokens off;

    # server_names_hash_bucket_size 64;
    # server_name_in_redirect off;

    include /etc/nginx/mime.types;
    default_type application/octet-stream;

    ##
    # SSL Settings
    ##

    ssl_protocols TLSv1 TLSv1.1 TLSv1.2; # Dropping SSLv3, ref: POODLE
    ssl_prefer_server_ciphers on;

    ##
    # Logging Settings
    ##

    access_log /var/log/nginx/access.log;
    error_log /var/log/nginx/error.log;

    ##
    # Gzip Settings
    ##

    gzip on;

    # gzip_vary on;
    # gzip_proxied any;
    # gzip_comp_level 6;
    # gzip_buffers 16 8k;
    # gzip_http_version 1.1;
    # gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;

    ##
    # Virtual Host Configs
    ##

    upstream api {
        server localhost:3000;
    }

    server {
        listen 80;
        server_name smartair.com www.smartair.com;
        root /var/www/html/SmartAir;

        location /api {
            proxy_pass http://api;
        }

        location = /50x.html {
            root html;
        }
    }

    server {
        listen 443 http2 ssl;
        listen [::]:443 http2 ssl;

        server_name smartair.com;

        ssl_certificate /etc/ssl/certs/nginx-selfsigned.crt;
        ssl_certificate_key /etc/ssl/private/nginx-selfsigned.key;
        ssl_dhparam /etc/ssl/certs/dhparam.pem;

        root /var/www/html/SmartAir;

        index index.html index.htm;

        location /api {
                proxy_pass http://api;
        }

        location = /50x.html {
                root html;
        }
    }


    include /etc/nginx/conf.d/*.conf;
    # include /etc/nginx/sites-enabled/*;
}

stream {
    include stream_mqtt_conf.d/*.conf;
}

                                </code></pre>
                                                    </td>
                                                </tr>
                                            </table>

                                            <br>

                                            <h4 id="nginx-mqtt">
                                                This is the MQTT stream of the nginx config file.
                                                <a href="#request-readings-retrieve-readings-of-a-device"><i class="glyphicon glyphicon-link"></i></a>
                                            </h4>

                                            <table class="table table-bordered">
                                                <tr>
                                                    <td class="response-text-sample" colspan="1">
                                                        <pre><code>

log_format mqtt '$remote_addr [$time_local] $protocol $status $bytes_received '
                '$bytes_sent $upstream_addr';

upstream hive_mq {
    server 127.0.0.1:9001;
    zone tcp_mem 64k;
}

match mqtt_conn {
        # Send CONNECT packet with client ID "nginx health check"
        send   \x10\x20\x00\x06\x4d\x51\x49\x73\x64\x70\x03\x02\x00\x3c\x00\x12\x6e\x67\x69\x6e\x78\x20\x68\x65\x61\x6c\x74\x68\x20\x63\x68\x65\x63\x6b;
        expect \x20\x02\x00\x00; # Entire payload of CONNACK packet
}

server {
    listen 9001;
    proxy_pass hive_mq;
    proxy_connect_timeout 1s;
    health_check match=mqtt_conn;

    access_log /var/log/nginx/mqtt_access.log mqtt;
    error_log  /var/log/nginx/mqtt_error.log; # Health check notifications
}
                                </code></pre>
                                                    </td>
                                                </tr>
                                            </table>
                                        </div>


                                        <!--

                -->







                                        <!--

                        -->


                                        <div class="endpoints-group">
                                            <h3 id="folder-pm2">
                                                PM2 configuration
                                                <a href="#folder-pm2"><i class="glyphicon glyphicon-link"></i></a>
                                            </h3>

                                            <div></div>



                                            <div class="request">

                                                <h4 id="folder-pm2">
                                                    This is the PM2 JSON configuration file for managing processes like instances in different clusters.
                                                    <a href="#folder-pm2"><i class="glyphicon glyphicon-link"></i></a>
                                                </h4>

                                                <table class="table table-bordered">
                                                    <tr>
                                                        <td class="response-text-sample" colspan="1">
                                                            <pre><code>
{
    "apps": [
        {
            "name": "HTTP_SERVER",
            "script": "node_modules/.bin/ts-node",
            "args": "src/server.ts",
            "watch": true,
            "instances": 4,
            "exec_mode": "cluster",
            "autorestart": true,
            "max_restarts": 5,
            "max_memory_restart": "1G",
            "min_uptime": 5000,
            "env": {
                "NODE_ENV": "production",
                "HOST": "smartair.com",
                "PORT": 3000,
                "PRIVATE_KEY": "****************",
                "ELASTICSEARCH_PW": "*************************",
                "ELASTICSEARCH_CLOUD_URL": "@40bf0081c1a54c0fa1f2bc9f7e382135.eu-central-1.aws.cloud.es.io:9243",
                "MONGO_USER": "smartair",
                "MONGO_PW": "**************"
            }
        },
        {
            "name": "MQTT_BROKER",
            "script": "node_modules/.bin/ts-node",
            "args": "src/broker.ts",
            "watch": true,
            "instances": 4,
            "exec_mode": "cluster",
            "autorestart": true,
            "max_restarts": 5,
            "max_memory_restart": "1G",
            "min_uptime": 5000,
            "env": {
                "NODE_ENV": "production",
                "HOST": "smartair.com",
                "PORT": 9001,
                "MONGO_USER": "smartair",
                "MONGO_PW": ""**************"",
                "ELASTICSEARCH_PW": "*************************",
                "ELASTICSEARCH_CLOUD_URL": "@40bf0081c1a54c0fa1f2bc9f7e382135.eu-central-1.aws.cloud.es.io:9243"
            }
        }
    ]
    }
    
                                </code></pre>
                                                        </td>
                                                    </tr>
                                                </table>


                                            </div>


                                            <!--

                -->
                                        </div>

                                    </div>
                                </div>
                            </div>
                        </div>

                        <script src="https://code.jquery.com/jquery-2.2.2.min.js"></script>
                        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
                        <script>
                            $(document).ready(function() {
                                $("table:not(.table)").addClass('table table-bordered');
                            });
                        </script>
</body>

</html>